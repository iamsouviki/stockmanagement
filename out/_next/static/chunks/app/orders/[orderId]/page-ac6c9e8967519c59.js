(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4560],{3377:(e,t,n)=>{"use strict";n.d(t,{c:()=>r});let r={name:"PAS Trading CO",address:"456 Tech Park Road, Bangalore, KA 560001, India",logoUrl:"",logoHint:"company text logo",contact:"Phone: +91 98765 43210 | Email: sales@stockpilot.co.in",storeType:"Electronics & Gadgets Retail",gstNo:"29ABCDE1234F1Z5"}},12543:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});let r=(0,n(40157).A)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},24450:(e,t,n)=>{"use strict";n.d(t,{default:()=>S});var r=n(95155),s=n(12115),a=n(35695),i=n(80410),l=n(87481),o=n(66695),c=n(30285),d=n(12543),m=n(87374),u=n(18763);let x=(0,n(40157).A)("Printer",[["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["path",{d:"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6",key:"1itne7"}],["rect",{x:"6",y:"14",width:"12",height:"8",rx:"1",key:"1ue0tg"}]]);var h=n(15599),p=n(85127),f=n(83013),g=n(35317),N=n(68856),j=n(66766),w=n(3377),v=n(49150),y=n(66424),b=n(51470),F=n(66681);let A=["owner","admin","employee"],D=["owner","admin"],E=["owner"];function S(e){let{orderId:t}=e,n=(0,a.useRouter)(),{userProfile:S}=(0,F.A)(),[P,T]=(0,s.useState)(null),[O,M]=(0,s.useState)(!0),{toast:z}=(0,l.dj)();(0,s.useEffect)(()=>{t&&(async()=>{M(!0);try{let e=await (0,i.r$)(t);e?T(e):(z({title:"Error",description:"Order not found.",variant:"destructive"}),n.push("/orders"))}catch(e){console.error("Error fetching order:",e),z({title:"Error",description:"Failed to fetch order details.",variant:"destructive"})}M(!1)})()},[t,z,n]);let I=e=>{try{(0,v.f)(e,w.c),z({title:"PDF Ready for Printing",description:"The bill is opening in a new window for printing."})}catch(e){console.error("Error generating PDF for printing:",e),z({title:"Error",description:"Failed to generate PDF for printing.",variant:"destructive"})}};if(O)return(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)(N.E,{className:"h-8 w-1/4"}),(0,r.jsx)(N.E,{className:"h-10 w-1/2"}),(0,r.jsxs)(o.Zp,{children:[(0,r.jsx)(o.aR,{children:(0,r.jsx)(N.E,{className:"h-6 w-1/3"})}),(0,r.jsxs)(o.Wu,{className:"space-y-2",children:[(0,r.jsx)(N.E,{className:"h-4 w-full"}),(0,r.jsx)(N.E,{className:"h-4 w-3/4"}),(0,r.jsx)(N.E,{className:"h-4 w-full"})]})]}),(0,r.jsxs)(o.Zp,{children:[(0,r.jsx)(o.aR,{children:(0,r.jsx)(N.E,{className:"h-6 w-1/4"})}),(0,r.jsx)(o.Wu,{children:(0,r.jsx)(N.E,{className:"h-24 w-full"})})]}),(0,r.jsx)(o.wL,{children:(0,r.jsx)(N.E,{className:"h-10 w-1/4"})})]});if(!P)return(0,r.jsx)("p",{className:"text-center text-lg",children:"Order not found."});let k=S&&E.includes(S.role),C=S&&D.includes(S.role);return(0,r.jsx)(b.default,{allowedRoles:A,children:(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)(c.$,{variant:"outline",onClick:()=>n.back(),size:"sm",children:[(0,r.jsx)(d.A,{className:"mr-2 h-4 w-4"})," Back to Orders"]}),(0,r.jsxs)(o.Zp,{className:"shadow-lg",children:[(0,r.jsxs)(o.aR,{className:"p-4 sm:p-6",children:[(0,r.jsxs)(o.ZB,{className:"text-xl sm:text-2xl text-primary",children:["Order Details: ",P.orderNumber]}),(0,r.jsxs)(o.BT,{className:"text-xs sm:text-sm",children:["Date: ",(e=>{let t;if(!e)return"N/A";if(e instanceof g.Dc)try{t=e.toDate()}catch(t){return console.error("Error converting Firestore Timestamp in OrderDetailPage:",t,e),"Invalid Date"}else if(e instanceof Date)t=e;else if("string"==typeof e)try{t=new Date(e)}catch(t){return console.error("Error parsing date string in OrderDetailPage:",t,e),"Invalid Date"}else if("function"!=typeof(null==e?void 0:e.toDate))return console.warn("Unformattable dateValue type in OrderDetailPage:",typeof e,e),"N/A";else try{t=e.toDate()}catch(t){return console.error("Error formatting object with toDate() in OrderDetailPage:",t,e),"Invalid Date"}try{if(isNaN(t.getTime()))return console.warn("Invalid Date object after conversion in OrderDetailPage:",t,"Original:",e),"Invalid Date";return(0,f.GP)(t,"PPpp")}catch(e){return console.error("Error formatting final Date object in OrderDetailPage:",e,t),"Invalid Date"}})(P.orderDate)]})]}),(0,r.jsxs)(o.Wu,{className:"space-y-4 p-4 sm:p-6 text-sm sm:text-base",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-semibold text-md sm:text-lg mb-1",children:"Customer Information"}),(0,r.jsxs)("p",{children:["Name: ",P.customerName]}),(0,r.jsxs)("p",{children:["Mobile: ",P.customerMobile]}),(0,r.jsxs)("p",{className:"whitespace-normal break-words",children:["Address: ",P.customerAddress||"N/A"]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-semibold text-md sm:text-lg mb-2",children:"Items Ordered"}),(0,r.jsxs)(y.F,{className:"w-full whitespace-nowrap rounded-md border",children:[(0,r.jsxs)(p.XI,{className:"min-w-[600px] sm:min-w-full",children:[(0,r.jsx)(p.A0,{children:(0,r.jsxs)(p.Hj,{children:[(0,r.jsx)(p.nd,{className:"w-[50px] sm:w-[60px] px-2 sm:px-4",children:"Image"}),(0,r.jsx)(p.nd,{className:"px-2 sm:px-4",children:"Product"}),(0,r.jsx)(p.nd,{className:"px-2 sm:px-4",children:"SN/Barcode"}),(0,r.jsx)(p.nd,{className:"text-right px-2 sm:px-4",children:"Price"}),(0,r.jsx)(p.nd,{className:"text-center px-2 sm:px-4",children:"Quantity"}),(0,r.jsx)(p.nd,{className:"text-right px-2 sm:px-4",children:"Subtotal"})]})}),(0,r.jsx)(p.BF,{children:P.items.map((e,t)=>(0,r.jsxs)(p.Hj,{children:[(0,r.jsx)(p.nA,{className:"px-2 sm:px-4",children:e.imageUrl?(0,r.jsx)(j.default,{src:e.imageUrl,alt:e.name,width:32,height:32,className:"rounded-md object-cover sm:w-10 sm:h-10","data-ai-hint":e.imageHint||"product item"}):(0,r.jsx)("div",{className:"w-8 h-8 sm:w-10 sm:h-10 bg-secondary rounded-md flex items-center justify-center text-muted-foreground",children:(0,r.jsx)(m.A,{className:"h-5 w-5 sm:h-6 sm:w-6"})})}),(0,r.jsx)(p.nA,{className:"text-xs sm:text-sm px-2 sm:px-4 whitespace-normal break-words max-w-[120px] sm:max-w-xs",children:e.name}),(0,r.jsx)(p.nA,{className:"text-xs sm:text-sm px-2 sm:px-4 whitespace-normal break-words",children:e.serialNumber||e.barcode||"N/A"}),(0,r.jsxs)(p.nA,{className:"text-right text-xs sm:text-sm px-2 sm:px-4",children:["₹",e.price.toFixed(2)]}),(0,r.jsx)(p.nA,{className:"text-center text-xs sm:text-sm px-2 sm:px-4",children:e.billQuantity}),(0,r.jsxs)(p.nA,{className:"text-right text-xs sm:text-sm px-2 sm:px-4",children:["₹",(e.price*e.billQuantity).toFixed(2)]})]},e.productId+t))})]}),(0,r.jsx)(y.$,{orientation:"horizontal"})]})]}),(0,r.jsxs)("div",{className:"text-right space-y-1 pr-2 sm:pr-4",children:[(0,r.jsxs)("p",{children:["Subtotal: ",(0,r.jsxs)("span",{className:"font-semibold",children:["₹",P.subtotal.toFixed(2)]})]}),(0,r.jsxs)("p",{children:["GST: ",(0,r.jsxs)("span",{className:"font-semibold",children:["₹",P.taxAmount.toFixed(2)]})]}),(0,r.jsxs)("p",{className:"text-lg sm:text-xl font-bold",children:["Total: ",(0,r.jsxs)("span",{className:"text-primary",children:["₹",P.totalAmount.toFixed(2)]})]})]})]}),(0,r.jsxs)(o.wL,{className:"flex flex-col sm:flex-row justify-end space-y-2 sm:space-y-0 sm:space-x-3 p-4 sm:p-6",children:[k&&(0,r.jsxs)(c.$,{variant:"outline",onClick:()=>{P&&n.push("/billing?fromOrder=".concat(P.id,"&intent=edit"))},className:"w-full sm:w-auto",children:[(0,r.jsx)(u.A,{className:"mr-2 h-4 w-4"})," Edit Order"]}),(0,r.jsxs)(c.$,{variant:"outline",onClick:()=>I(P),className:"w-full sm:w-auto",children:[(0,r.jsx)(x,{className:"mr-2 h-4 w-4"})," Print Bill"]}),C&&(0,r.jsxs)(c.$,{onClick:()=>{P&&n.push("/billing?fromOrder=".concat(P.id))},className:"w-full sm:w-auto bg-accent hover:bg-accent/90 text-accent-foreground",children:[(0,r.jsx)(h.A,{className:"mr-2 h-4 w-4"})," Re-create Bill"]})]})]})]})})}},28905:(e,t,n)=>{"use strict";n.d(t,{C:()=>i});var r=n(12115),s=n(6101),a=n(52712),i=e=>{let{present:t,children:n}=e,i=function(e){var t,n;let[s,i]=r.useState(),o=r.useRef({}),c=r.useRef(e),d=r.useRef("none"),[m,u]=(t=e?"mounted":"unmounted",n={mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}},r.useReducer((e,t)=>{let r=n[e][t];return null!=r?r:e},t));return r.useEffect(()=>{let e=l(o.current);d.current="mounted"===m?e:"none"},[m]),(0,a.N)(()=>{let t=o.current,n=c.current;if(n!==e){let r=d.current,s=l(t);e?u("MOUNT"):"none"===s||(null==t?void 0:t.display)==="none"?u("UNMOUNT"):n&&r!==s?u("ANIMATION_OUT"):u("UNMOUNT"),c.current=e}},[e,u]),(0,a.N)(()=>{if(s){var e;let t,n=null!=(e=s.ownerDocument.defaultView)?e:window,r=e=>{let r=l(o.current).includes(e.animationName);if(e.target===s&&r&&(u("ANIMATION_END"),!c.current)){let e=s.style.animationFillMode;s.style.animationFillMode="forwards",t=n.setTimeout(()=>{"forwards"===s.style.animationFillMode&&(s.style.animationFillMode=e)})}},a=e=>{e.target===s&&(d.current=l(o.current))};return s.addEventListener("animationstart",a),s.addEventListener("animationcancel",r),s.addEventListener("animationend",r),()=>{n.clearTimeout(t),s.removeEventListener("animationstart",a),s.removeEventListener("animationcancel",r),s.removeEventListener("animationend",r)}}u("ANIMATION_END")},[s,u]),{isPresent:["mounted","unmountSuspended"].includes(m),ref:r.useCallback(e=>{e&&(o.current=getComputedStyle(e)),i(e)},[])}}(t),o="function"==typeof n?n({present:i.isPresent}):r.Children.only(n),c=(0,s.s)(i.ref,function(e){var t,n;let r=null==(t=Object.getOwnPropertyDescriptor(e.props,"ref"))?void 0:t.get,s=r&&"isReactWarning"in r&&r.isReactWarning;return s?e.ref:(s=(r=null==(n=Object.getOwnPropertyDescriptor(e,"ref"))?void 0:n.get)&&"isReactWarning"in r&&r.isReactWarning)?e.props.ref:e.props.ref||e.ref}(o));return"function"==typeof n||i.isPresent?r.cloneElement(o,{ref:c}):null};function l(e){return(null==e?void 0:e.animationName)||"none"}i.displayName="Presence"},39033:(e,t,n)=>{"use strict";n.d(t,{c:()=>s});var r=n(12115);function s(e){let t=r.useRef(e);return r.useEffect(()=>{t.current=e}),r.useMemo(()=>(...e)=>t.current?.(...e),[])}},46081:(e,t,n)=>{"use strict";n.d(t,{A:()=>i,q:()=>a});var r=n(12115),s=n(95155);function a(e,t){let n=r.createContext(t),a=e=>{let{children:t,...a}=e,i=r.useMemo(()=>a,Object.values(a));return(0,s.jsx)(n.Provider,{value:i,children:t})};return a.displayName=e+"Provider",[a,function(s){let a=r.useContext(n);if(a)return a;if(void 0!==t)return t;throw Error(`\`${s}\` must be used within \`${e}\``)}]}function i(e,t=[]){let n=[],a=()=>{let t=n.map(e=>r.createContext(e));return function(n){let s=n?.[e]||t;return r.useMemo(()=>({[`__scope${e}`]:{...n,[e]:s}}),[n,s])}};return a.scopeName=e,[function(t,a){let i=r.createContext(a),l=n.length;n=[...n,a];let o=t=>{let{scope:n,children:a,...o}=t,c=n?.[e]?.[l]||i,d=r.useMemo(()=>o,Object.values(o));return(0,s.jsx)(c.Provider,{value:d,children:a})};return o.displayName=t+"Provider",[o,function(n,s){let o=s?.[e]?.[l]||i,c=r.useContext(o);if(c)return c;if(void 0!==a)return a;throw Error(`\`${n}\` must be used within \`${t}\``)}]},function(...e){let t=e[0];if(1===e.length)return t;let n=()=>{let n=e.map(e=>({useScope:e(),scopeName:e.scopeName}));return function(e){let s=n.reduce((t,{useScope:n,scopeName:r})=>{let s=n(e)[`__scope${r}`];return{...t,...s}},{});return r.useMemo(()=>({[`__scope${t.scopeName}`]:s}),[s])}};return n.scopeName=t.scopeName,n}(a,...t)]}},49150:(e,t,n)=>{"use strict";n.d(t,{f:()=>i});var r=n(26597),s=n(83013),a=n(35317);function i(e,t){let n=new r.Ay({orientation:"p",unit:"mm",format:"a4"}),i=n.internal.pageSize.getHeight(),l=n.internal.pageSize.getWidth(),o=l-20,c=10;n.setFontSize(18),n.setFont("helvetica","bold"),n.text(t.name,l/2,c,{align:"center"}),c+=7,n.setFontSize(9),n.setFont("helvetica","normal"),n.text(t.storeType,l/2,c,{align:"center"}),c+=8,n.setFontSize(8);let d=n.splitTextToSize(t.address,o/2-5);n.text(d,10,c);let m=n.splitTextToSize(t.contact,o/2-5);n.text(m,l-10,c,{align:"right"}),n.setFontSize(8);let u=n.getLineHeight(),x=d.length*u,h=m.length*u;if(c+=Math.max(x,h)+2,n.text("GSTIN: ".concat(t.gstNo),10,c),c+=5,n.setLineWidth(.3),n.line(10,c,l-10,c),c+=6,n.setFontSize(14),n.setFont("helvetica","bold"),n.text("INVOICE",l/2,c,{align:"center"}),c+=7,n.setFontSize(9),n.setFont("helvetica","normal"),n.text("Order No: ".concat(e.orderNumber),10,c),n.text("Date: ".concat(function(e){let t;if(!e)return"N/A";if(e instanceof a.Dc)try{t=e.toDate()}catch(t){return console.error("Error converting Firestore Timestamp to Date:",t,e),"Invalid Date"}else if(e instanceof Date)t=e;else{if("string"!=typeof e)return console.warn("Unknown date type in formatDateForPdf:",e),"N/A";t=new Date(e)}try{if(isNaN(t.getTime()))return console.warn("Invalid date created in formatDateForPdf:",e,"Resulted in:",t),"Invalid Date";return(0,s.GP)(t,"MMM dd, yyyy HH:mm:ss")}catch(e){return console.error("Error formatting date in formatDateForPdf:",e,t),"Error Date"}}(e.orderDate)),l-10,c,{align:"right"}),c+=5,n.text("Customer: ".concat(e.customerName||"N/A"),10,c),c+=5,n.text("Mobile: ".concat(e.customerMobile||"N/A"),10,c),c+=5,e.customerAddress){n.setFontSize(8);let t="Address: ".concat(e.customerAddress),r=n.splitTextToSize(t,o);n.text(r,10,c),n.setFontSize(8);let s=r.length*n.getLineHeight();c+=s+2,n.setFontSize(9)}else n.text("Address: N/A",10,c),c+=5;c+=2;let p=.3*o,f=.2*o,g=.08*o,N=.2*o,j=.22*o,w={productName:10,snBarcode:10+p,qty:10+p+f,price:10+p+f+g,subtotal:10+p+f+g+N},v=()=>{c+=1,n.setLineWidth(.1),n.line(10,c,l-10,c),c+=4,n.setFontSize(9),n.setFont("helvetica","bold"),n.text("Product Name",w.productName,c),n.text("SN/Barcode",w.snBarcode,c),n.text("Qty",w.qty+g/2,c,{align:"center"}),n.text("Price",w.price+N,c,{align:"right"}),n.text("Subtotal",w.subtotal+j,c,{align:"right"}),n.setFontSize(9),c+=n.getLineHeight(),c+=2,n.line(10,c,l-10,c),c+=3,n.setFont("helvetica","normal"),n.setFontSize(8)};v(),n.setFontSize(8),e.items.forEach(e=>{n.setFontSize(8);let t=n.getLineHeight(),r=n.splitTextToSize(e.name,p-2),s=e.serialNumber||e.barcode||"N/A",a=n.splitTextToSize(s,f-2),l=Math.max(r.length,a.length,1)*t+2;c+l>i-45&&(n.addPage(),c=10,v(),n.setFontSize(8));let o=c;n.text(r,w.productName+1,o),n.text(a,w.snBarcode+1,o),n.text(e.billQuantity.toString(),w.qty+g/2,o,{align:"center"}),n.text("₹".concat(e.price.toFixed(2)),w.price+N-1,o,{align:"right"}),n.text("₹".concat((e.price*e.billQuantity).toFixed(2)),w.subtotal+j-1,o,{align:"right"}),c+=l}),c+35>i-10&&(n.addPage(),c=10),c+=5;let y=10+.55*o,b=l-10-1;n.setLineWidth(.1),n.line(10,c,l-10,c),c+=5,n.setFontSize(9),n.setFont("helvetica","normal"),n.text("Subtotal:",y,c,{align:"left"}),n.text("₹".concat(e.subtotal.toFixed(2)),b,c,{align:"right"}),c+=5,n.text("GST (".concat("18","%):"),y,c,{align:"left"}),n.text("₹".concat(e.taxAmount.toFixed(2)),b,c,{align:"right"}),c+=5,n.setFontSize(10),n.setFont("helvetica","bold"),n.line(y-2,c,l-10,c),c+=5,n.text("Total Amount:",y,c,{align:"left"}),n.text("₹".concat(e.totalAmount.toFixed(2)),b,c,{align:"right"}),c+=10;let F=i-5-3;n.setFontSize(7),n.setFont("helvetica","italic");let A=n.internal.pages.length;for(let e=1;e<=A;e++)n.setPage(e),n.text("Page ".concat(e," of ").concat(A),10,F,{align:"left"}),n.text("Thank you for your business! - Generated by ".concat(t.name),l/2,F,{align:"center"});n.autoPrint({variant:"non-conform"}),n.output("dataurlnewwindow",{filename:"".concat(t.name.replace(/\s+/g,"_"),"-Bill-").concat(e.orderNumber,".pdf")})}},52712:(e,t,n)=>{"use strict";n.d(t,{N:()=>s});var r=n(12115),s=globalThis?.document?r.useLayoutEffect:()=>{}},63655:(e,t,n)=>{"use strict";n.d(t,{hO:()=>o,sG:()=>l});var r=n(12115),s=n(47650),a=n(99708),i=n(95155),l=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"].reduce((e,t)=>{let n=r.forwardRef((e,n)=>{let{asChild:r,...s}=e,l=r?a.DX:t;return"undefined"!=typeof window&&(window[Symbol.for("radix-ui")]=!0),(0,i.jsx)(l,{...s,ref:n})});return n.displayName=`Primitive.${t}`,{...e,[t]:n}},{});function o(e,t){e&&s.flushSync(()=>e.dispatchEvent(t))}},85185:(e,t,n)=>{"use strict";function r(e,t,{checkForDefaultPrevented:n=!0}={}){return function(r){if(e?.(r),!1===n||!r.defaultPrevented)return t?.(r)}}n.d(t,{m:()=>r})},95221:(e,t,n)=>{Promise.resolve().then(n.bind(n,24450))}},e=>{var t=t=>e(e.s=t);e.O(0,[2992,9855,3930,9701,3013,7655,6766,1327,8970,6340,8441,1684,7358],()=>t(95221)),_N_E=e.O()}]);