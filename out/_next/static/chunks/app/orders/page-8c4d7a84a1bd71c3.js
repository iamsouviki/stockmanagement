(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1778],{9572:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(40157).A)("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]])},14636:(e,t,s)=>{"use strict";s.d(t,{AM:()=>i,Wv:()=>d,hl:()=>o});var a=s(95155),r=s(12115),l=s(38427),n=s(59434);let i=l.bL,d=l.l9,o=r.forwardRef((e,t)=>{let{className:s,align:r="center",sideOffset:i=4,...d}=e;return(0,a.jsx)(l.ZL,{children:(0,a.jsx)(l.UC,{ref:t,align:r,sideOffset:i,className:(0,n.cn)("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...d})})});o.displayName=l.UC.displayName},24371:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(40157).A)("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]])},39858:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>E});var a=s(95155),r=s(12115),l=s(80410),n=s(85127),i=s(30285);let d=(0,s(40157).A)("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);var o=s(15599),c=s(18763),m=s(6874),x=s.n(m),u=s(83013),h=s(35317),f=s(66424),p=s(66681);let g=e=>{let{orders:t,filtersActive:s}=e,{userProfile:r}=(0,p.A)(),l=e=>{let t;if(!e)return"N/A";if(e instanceof h.Dc)try{t=e.toDate()}catch(t){return console.error("Error converting Firestore Timestamp in OrderTable:",t,e),"Invalid Date"}else if(e instanceof Date)t=e;else if("string"==typeof e)try{if(t=new Date(e),isNaN(t.getTime()))throw Error("Invalid date string parsed")}catch(t){return console.error("Error parsing date string in OrderTable:",t,e),"Invalid Date"}else if("function"!=typeof(null==e?void 0:e.toDate))return console.warn("Unformattable dateValue type in OrderTable:",typeof e,e),"N/A";else try{if(t=e.toDate(),isNaN(t.getTime()))throw Error("Invalid date from toDate()")}catch(t){return console.error("Error formatting object with toDate() in OrderTable:",t,e),"Invalid Date"}try{return(0,u.GP)(t,"PPpp")}catch(e){return console.error("Error formatting final Date object in OrderTable:",e,t),"Invalid Date"}},m=e=>(null==r?void 0:r.role)==="owner",g=e=>(null==r?void 0:r.role)==="owner"||(null==r?void 0:r.role)==="admin";return(0,a.jsxs)(f.F,{className:"w-full whitespace-nowrap rounded-md border-b",children:[(0,a.jsxs)(n.XI,{className:"min-w-[700px] sm:min-w-full",children:[(0,a.jsx)(n.A0,{children:(0,a.jsxs)(n.Hj,{children:[(0,a.jsx)(n.nd,{className:"px-2 sm:px-4",children:"Order Number"}),(0,a.jsx)(n.nd,{className:"px-2 sm:px-4",children:"Customer"}),(0,a.jsx)(n.nd,{className:"px-2 sm:px-4",children:"Date"}),(0,a.jsx)(n.nd,{className:"text-right px-2 sm:px-4",children:"Total Amount"}),(0,a.jsx)(n.nd,{className:"text-center px-2 sm:px-4",children:"Items"}),(0,a.jsx)(n.nd,{className:"text-center w-[100px] sm:w-[140px] px-2 sm:px-4",children:"Actions"})]})}),(0,a.jsx)(n.BF,{children:0===t.length?(0,a.jsx)(n.Hj,{children:(0,a.jsx)(n.nA,{colSpan:6,className:"h-24 text-center text-sm sm:text-base",children:s?"No orders match your filters.":"No orders found."})}):t.map(e=>(0,a.jsxs)(n.Hj,{children:[(0,a.jsx)(n.nA,{className:"font-medium text-xs sm:text-sm px-2 sm:px-4",children:e.orderNumber}),(0,a.jsx)(n.nA,{className:"text-xs sm:text-sm px-2 sm:px-4 whitespace-normal break-words",children:e.customerName||e.customerMobile||"Walk-in"}),(0,a.jsx)(n.nA,{className:"text-xs sm:text-sm px-2 sm:px-4",children:l(e.orderDate)}),(0,a.jsxs)(n.nA,{className:"text-right text-xs sm:text-sm px-2 sm:px-4",children:["â‚¹",e.totalAmount.toFixed(2)]}),(0,a.jsx)(n.nA,{className:"text-center text-xs sm:text-sm px-2 sm:px-4",children:e.items.length}),(0,a.jsx)(n.nA,{className:"text-center px-2 sm:px-4",children:(0,a.jsxs)("div",{className:"flex justify-center space-x-1 sm:space-x-2",children:[(0,a.jsx)(i.$,{variant:"ghost",size:"icon",className:"h-7 w-7 sm:h-8 sm:w-8",asChild:!0,title:"View Order Details",children:(0,a.jsx)(x(),{href:"/orders/".concat(e.id),children:(0,a.jsx)(d,{className:"h-3 w-3 sm:h-4 sm:w-4 text-blue-600"})})}),g(e)&&(0,a.jsx)(i.$,{variant:"ghost",size:"icon",className:"h-7 w-7 sm:h-8 sm:w-8",asChild:!0,title:"Re-create Bill from this Order",children:(0,a.jsx)(x(),{href:"/billing?fromOrder=".concat(e.id),children:(0,a.jsx)(o.A,{className:"h-3 w-3 sm:h-4 sm:w-4 text-green-600"})})}),m(e)&&(0,a.jsx)(i.$,{variant:"ghost",size:"icon",className:"h-7 w-7 sm:h-8 sm:w-8",asChild:!0,title:"Edit Order",children:(0,a.jsx)(x(),{href:"/billing?fromOrder=".concat(e.id,"&intent=edit"),children:(0,a.jsx)(c.A,{className:"h-3 w-3 sm:h-4 sm:w-4 text-orange-500"})})})]})})]},e.id))})]}),(0,a.jsx)(f.$,{orientation:"horizontal"})]})};var j=s(87481),w=s(68856),N=s(51470),y=s(9572),v=s(68718),b=s(24371),A=s(51920),C=s(62523),D=s(14636),_=s(85511),k=s(66695),L=s(81448);let O=["owner","admin","employee"],P=["owner"];function E(){let[e,t]=(0,r.useState)([]),[s,n]=(0,r.useState)(!0),{toast:d}=(0,j.dj)(),{userProfile:o}=(0,p.A)(),[c,m]=(0,r.useState)(""),[f,E]=(0,r.useState)(""),[S,z]=(0,r.useState)(void 0),[R,F]=(0,r.useState)(!1),[I,T]=(0,r.useState)(10),[$,M]=(0,r.useState)(null),[H,U]=(0,r.useState)(null),[V,G]=(0,r.useState)([null]),[W,Z]=(0,r.useState)(!1),[q,B]=(0,r.useState)(!1),J=(0,r.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"initial";Z(!0),n("initial"===e||"reset"===e);let s=null,a=null;"next"===e&&H?s=H:"prev"===e&&$?a=$:"reset"===e&&(G([null]),M(null),U(null));try{let r=I+ +("prev"!==e),{orders:n,firstDoc:i,lastDoc:d}=await (0,l.hA)(r,"orderDate","desc",s,a),o=n,c=!1;"prev"!==e&&n.length>I?(o=n.slice(0,I),c=!0):c="prev"===e&&!!(n.length>0),t(o),M(i),U(d),B(c),"next"===e&&i?G(e=>[...e,i]):"prev"===e&&V.length>1&&G(e=>e.slice(0,-1))}catch(e){console.error("Error fetching orders:",e),d({title:"Error",description:"Failed to fetch orders.",variant:"destructive"})}n(!1),Z(!1)},[I,d,H,$,V]);(0,r.useEffect)(()=>{J("initial")},[I]);let X=(0,r.useMemo)(()=>e.filter(e=>{var t,s;let a=!c||e.orderNumber.toLowerCase().includes(c.toLowerCase()),r=!f||(null==(t=e.customerName)?void 0:t.toLowerCase().includes(f.toLowerCase()))||(null==(s=e.customerMobile)?void 0:s.toLowerCase().includes(f.toLowerCase())),l=!0;if((null==S?void 0:S.from)&&e.orderDate){let t=e.orderDate instanceof h.Dc?e.orderDate.toDate():new Date(e.orderDate);if(isNaN(t.getTime()))l=!1;else{let e=new Date(S.from);if(e.setHours(0,0,0,0),S.to){let s=new Date(S.to);s.setHours(23,59,59,999),l=t>=e&&t<=s}else l=t>=e}}return a&&r&&l}),[e,c,f,S]);return(0,a.jsx)(N.default,{allowedRoles:O,children:(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold tracking-tight text-primary",children:"Order History"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"View and manage past orders."})]}),(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row gap-2 w-full sm:w-auto",children:[(0,a.jsxs)(i.$,{variant:"outline",onClick:()=>F(!R),className:"w-full sm:w-auto",children:[(0,a.jsx)(y.A,{className:"mr-2 h-5 w-5"})," ",R?"Hide":"Show"," Filters"]}),o&&P.includes(o.role)&&(0,a.jsx)(i.$,{asChild:!0,variant:"outline",className:"w-full sm:w-auto border-accent text-accent hover:bg-accent/10 hover:text-accent",children:(0,a.jsxs)(x(),{href:"/settings/export-orders",children:[(0,a.jsx)(v.A,{className:"mr-2 h-5 w-5"})," Export Orders"]})}),(0,a.jsx)(i.$,{asChild:!0,className:"bg-primary hover:bg-primary/90 w-full sm:w-auto",children:(0,a.jsx)(x(),{href:"/billing",children:"Create New Bill"})})]})]}),R&&(0,a.jsxs)(k.Zp,{className:"shadow-md",children:[(0,a.jsx)(k.aR,{children:(0,a.jsxs)(k.ZB,{className:"text-lg flex justify-between items-center",children:["Filter Orders (Client-Side)",(0,a.jsxs)(i.$,{variant:"ghost",size:"sm",onClick:()=>{m(""),E(""),z(void 0),F(!1)},className:"text-xs",children:[(0,a.jsx)(b.A,{className:"mr-1 h-4 w-4"})," Reset Filters"]})]})}),(0,a.jsxs)(k.Wu,{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4",children:[(0,a.jsx)(C.p,{placeholder:"Filter by Order Number...",value:c,onChange:e=>m(e.target.value),className:"text-sm"}),(0,a.jsx)(C.p,{placeholder:"Filter by Customer Name/Mobile...",value:f,onChange:e=>E(e.target.value),className:"text-sm"}),(0,a.jsxs)(D.AM,{children:[(0,a.jsx)(D.Wv,{asChild:!0,children:(0,a.jsxs)(i.$,{variant:"outline",className:"w-full justify-start text-left font-normal text-sm ".concat(!S&&"text-muted-foreground"),children:[(0,a.jsx)(A.A,{className:"mr-2 h-4 w-4"}),(null==S?void 0:S.from)?S.to?(0,a.jsxs)(a.Fragment,{children:[(0,u.GP)(S.from,"LLL dd, y")," -"," ",(0,u.GP)(S.to,"LLL dd, y")]}):(0,u.GP)(S.from,"LLL dd, y"):(0,a.jsx)("span",{children:"Filter by Date Range..."})]})}),(0,a.jsx)(D.hl,{className:"w-auto p-0",align:"start",children:(0,a.jsx)(_.V,{initialFocus:!0,mode:"range",defaultMonth:null==S?void 0:S.from,selected:S,onSelect:z,numberOfMonths:2})})]})]})]}),s?(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)(w.E,{className:"h-12 w-full"}),(0,a.jsx)(w.E,{className:"h-20 w-full"}),(0,a.jsx)(w.E,{className:"h-20 w-full"}),(0,a.jsx)(w.E,{className:"h-20 w-full"})]}):(0,a.jsxs)(k.Zp,{className:"shadow-lg",children:[(0,a.jsx)(k.aR,{children:(0,a.jsx)(k.ZB,{className:"text-lg sm:text-xl text-primary",children:"All Orders"})}),(0,a.jsx)(k.Wu,{className:"p-0",children:(0,a.jsx)(g,{orders:X,filtersActive:""!==c||""!==f||!!S})}),(0,a.jsx)(L.A,{canGoPrev:V.length>1&&!W,canGoNext:q&&!W,onPrevPage:()=>{V.length>1&&!W&&J("prev")},onNextPage:()=>{q&&!W&&J("next")},itemsPerPage:I,onItemsPerPageChange:e=>{T(Number(e))}})]})]})})}},59409:(e,t,s)=>{"use strict";s.d(t,{bq:()=>x,eb:()=>p,gC:()=>f,l6:()=>c,yv:()=>m});var a=s(95155),r=s(12115),l=s(78935),n=s(79556),i=s(77381),d=s(10518),o=s(59434);let c=l.bL;l.YJ;let m=l.WT,x=r.forwardRef((e,t)=>{let{className:s,children:r,...i}=e;return(0,a.jsxs)(l.l9,{ref:t,className:(0,o.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",s),...i,children:[r,(0,a.jsx)(l.In,{asChild:!0,children:(0,a.jsx)(n.A,{className:"h-4 w-4 opacity-50"})})]})});x.displayName=l.l9.displayName;let u=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(l.PP,{ref:t,className:(0,o.cn)("flex cursor-default items-center justify-center py-1",s),...r,children:(0,a.jsx)(i.A,{className:"h-4 w-4"})})});u.displayName=l.PP.displayName;let h=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(l.wn,{ref:t,className:(0,o.cn)("flex cursor-default items-center justify-center py-1",s),...r,children:(0,a.jsx)(n.A,{className:"h-4 w-4"})})});h.displayName=l.wn.displayName;let f=r.forwardRef((e,t)=>{let{className:s,children:r,position:n="popper",...i}=e;return(0,a.jsx)(l.ZL,{children:(0,a.jsxs)(l.UC,{ref:t,className:(0,o.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===n&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:n,...i,children:[(0,a.jsx)(u,{}),(0,a.jsx)(l.LM,{className:(0,o.cn)("p-1","popper"===n&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:r}),(0,a.jsx)(h,{})]})})});f.displayName=l.UC.displayName,r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(l.JU,{ref:t,className:(0,o.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",s),...r})}).displayName=l.JU.displayName;let p=r.forwardRef((e,t)=>{let{className:s,children:r,...n}=e;return(0,a.jsxs)(l.q7,{ref:t,className:(0,o.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...n,children:[(0,a.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,a.jsx)(l.VF,{children:(0,a.jsx)(d.A,{className:"h-4 w-4"})})}),(0,a.jsx)(l.p4,{children:r})]})});p.displayName=l.q7.displayName,r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(l.wv,{ref:t,className:(0,o.cn)("-mx-1 my-1 h-px bg-muted",s),...r})}).displayName=l.wv.displayName},62523:(e,t,s)=>{"use strict";s.d(t,{p:()=>n});var a=s(95155),r=s(12115),l=s(59434);let n=r.forwardRef((e,t)=>{let{className:s,type:r,...n}=e;return(0,a.jsx)("input",{type:r,className:(0,l.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:t,...n})});n.displayName="Input"},81448:(e,t,s)=>{"use strict";s.d(t,{A:()=>o});var a=s(95155),r=s(30285),l=s(59409),n=s(965),i=s(73158);let d=[10,20,30,50,100];function o(e){let{onPrevPage:t,onNextPage:s,canGoPrev:o,canGoNext:c,itemsPerPage:m,onItemsPerPageChange:x,currentPage:u,totalItems:h}=e;return(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-4 p-2 sm:p-4 border-t",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 text-sm text-muted-foreground",children:[(0,a.jsx)("span",{children:"Rows per page:"}),(0,a.jsxs)(l.l6,{value:String(m),onValueChange:x,children:[(0,a.jsx)(l.bq,{className:"w-[70px] h-8 text-xs sm:text-sm",children:(0,a.jsx)(l.yv,{placeholder:m})}),(0,a.jsx)(l.gC,{children:d.map(e=>(0,a.jsx)(l.eb,{value:String(e),className:"text-xs sm:text-sm",children:e},e))})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsxs)(r.$,{variant:"outline",size:"sm",onClick:t,disabled:!o,className:"h-8 w-8 p-0 sm:h-9 sm:w-auto sm:px-3",children:[(0,a.jsx)(n.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"hidden sm:inline ml-1",children:"Previous"})]}),(0,a.jsxs)(r.$,{variant:"outline",size:"sm",onClick:s,disabled:!c,className:"h-8 w-8 p-0 sm:h-9 sm:w-auto sm:px-3",children:[(0,a.jsx)("span",{className:"hidden sm:inline mr-1",children:"Next"}),(0,a.jsx)(i.A,{className:"h-4 w-4"})]})]})]})}},85511:(e,t,s)=>{"use strict";s.d(t,{V:()=>o});var a=s(95155);s(12115);var r=s(965),l=s(73158),n=s(37466),i=s(59434),d=s(30285);function o(e){let{className:t,classNames:s,showOutsideDays:o=!0,...c}=e;return(0,a.jsx)(n.hv,{showOutsideDays:o,className:(0,i.cn)("p-3",t),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:(0,i.cn)((0,d.r)({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:(0,i.cn)((0,d.r)({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...s},components:{IconLeft:e=>{let{className:t,...s}=e;return(0,a.jsx)(r.A,{className:(0,i.cn)("h-4 w-4",t),...s})},IconRight:e=>{let{className:t,...s}=e;return(0,a.jsx)(l.A,{className:(0,i.cn)("h-4 w-4",t),...s})}},...c})}o.displayName="Calendar"},91002:(e,t,s)=>{Promise.resolve().then(s.bind(s,39858))}},e=>{var t=t=>e(e.s=t);e.O(0,[2992,9855,9701,3013,5209,6874,7655,3647,2475,7759,8970,6340,8441,1684,7358],()=>t(91002)),_N_E=e.O()}]);