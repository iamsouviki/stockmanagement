(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2007],{32383:()=>{},37607:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(40157).A)("CloudUpload",[["path",{d:"M12 13v8",key:"1l5pq0"}],["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"m8 17 4-4 4 4",key:"1quai1"}]])},40507:(e,t,r)=>{Promise.resolve().then(r.bind(r,98607))},51470:(e,t,r)=>{"use strict";r.d(t,{default:()=>c});var a=r(95155),i=r(66681),s=r(35695),n=r(12115),o=r(68856);let l=()=>(0,a.jsxs)("div",{className:"space-y-6 p-4",children:[(0,a.jsx)(o.E,{className:"h-10 w-1/3"}),(0,a.jsx)(o.E,{className:"h-8 w-1/2"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsx)(o.E,{className:"h-40 w-full"}),(0,a.jsx)(o.E,{className:"h-40 w-full"})]}),(0,a.jsx)(o.E,{className:"h-60 w-full"})]});function c(e){let{children:t,allowedRoles:r,redirectPath:o="/login"}=e,{currentUser:c,userProfile:d,isLoading:u}=(0,i.A)(),m=(0,s.useRouter)(),p=(0,s.usePathname)(),[g,f]=(0,n.useState)(!1);return((0,n.useEffect)(()=>{let e=!1;u||(c?r&&r.length>0?d&&r.includes(d.role)?e=!0:"/"!==p&&m.replace("/"):e=!0:p!==o?m.replace(o):e=!0),g!==e&&f(e)},[c,d,u,m,r,o,p]),u)?(0,a.jsx)(l,{}):g?(0,a.jsx)(a.Fragment,{children:t}):(0,a.jsx)(l,{})}},62523:(e,t,r)=>{"use strict";r.d(t,{p:()=>n});var a=r(95155),i=r(12115),s=r(59434);let n=i.forwardRef((e,t)=>{let{className:r,type:i,...n}=e;return(0,a.jsx)("input",{type:i,className:(0,s.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",r),ref:t,...n})});n.displayName="Input"},63655:(e,t,r)=>{"use strict";r.d(t,{hO:()=>l,sG:()=>o});var a=r(12115),i=r(47650),s=r(99708),n=r(95155),o=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"].reduce((e,t)=>{let r=a.forwardRef((e,r)=>{let{asChild:a,...i}=e,o=a?s.DX:t;return"undefined"!=typeof window&&(window[Symbol.for("radix-ui")]=!0),(0,n.jsx)(o,{...i,ref:r})});return r.displayName=`Primitive.${t}`,{...e,[t]:r}},{});function l(e,t){e&&i.flushSync(()=>e.dispatchEvent(t))}},80410:(e,t,r)=>{"use strict";r.d(t,{Ah:()=>m,Bj:()=>x,DD:()=>v,Gk:()=>C,K7:()=>g,WF:()=>E,bD:()=>B,bW:()=>u,d$:()=>h,hA:()=>k,iB:()=>y,lw:()=>f,od:()=>w,oo:()=>b,r$:()=>A,st:()=>p,uq:()=>z,vc:()=>N,w0:()=>P,xt:()=>j,yw:()=>S});var a=r(56104),i=r(35317),s=r(83013);let n=async function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"asc",s=arguments.length>3?arguments[3]:void 0,n=arguments.length>4?arguments[4]:void 0,o=arguments.length>5?arguments[5]:void 0,l=(0,i.P)((0,i.rJ)(a.db,e));t&&(l=(0,i.P)(l,(0,i.My)(t,r))),s&&s>0&&(l=n?(0,i.P)(l,(0,i.HM)(n),(0,i.AB)(s)):o?(0,i.P)(l,(0,i.rf)(o),(0,i.$1)(s)):(0,i.P)(l,(0,i.AB)(s)));let c=await (0,i.GG)(l);return{data:c.docs.map(e=>({id:e.id,...e.data()})),firstDoc:c.docs.length>0?c.docs[0]:null,lastDoc:c.docs.length>0?c.docs[c.docs.length-1]:null}},o=async(e,t)=>{let r=(0,i.H9)(a.db,e,t),s=await (0,i.x7)(r);return s.exists()?{id:s.id,...s.data()}:null},l=async(e,t)=>(await (0,i.gS)((0,i.rJ)(a.db,e),{...t,createdAt:(0,i.O5)(),updatedAt:(0,i.O5)()})).id,c=async(e,t,r)=>{let s=(0,i.H9)(a.db,e,t);await (0,i.mZ)(s,{...r,updatedAt:(0,i.O5)()})},d=async(e,t)=>{await (0,i.kd)((0,i.H9)(a.db,e,t))},u=async()=>{let{data:e}=await n("categories","name");return e},m=async e=>{let t=await l("categories",e),r=i.Dc.now();return{id:t,...e,createdAt:r,updatedAt:r}},p=(e,t)=>c("categories",e,t),g=e=>d("categories",e),f=async e=>{let t=e.trim(),r=(0,i.P)((0,i.rJ)(a.db,"categories"),(0,i._M)("name","==",t),(0,i.AB)(1)),s=await (0,i.GG)(r);if(s.empty)return m({name:t});{let e=s.docs[0];return{id:e.id,...e.data()}}},h=async()=>{let{data:e}=await n("products","name");return e},y=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"name",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"asc",a=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0,{data:s,firstDoc:o,lastDoc:l}=await n("products",t,r,e,a,i);return{products:s,firstDoc:o,lastDoc:l}},b=e=>o("products",e),x=e=>l("products",e),N=(e,t)=>c("products",e,t),v=e=>d("products",e),w=async()=>{let{data:e}=await n("customers","name");return e},j=e=>o("customers",e),S=e=>l("customers",e),C=(e,t)=>c("customers",e,t),P=e=>d("customers",e),B=async e=>{let t=(0,i.P)((0,i.rJ)(a.db,"customers"),(0,i._M)("mobileNumber","==",e));return(await (0,i.GG)(t)).docs.map(e=>({id:e.id,...e.data()}))},E=async()=>{let{data:e}=await n("orders","orderDate","desc");return e},k=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"orderDate",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"desc",a=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0,{data:s,firstDoc:o,lastDoc:l}=await n("orders",t,r,e,a,i);return{orders:s,firstDoc:o,lastDoc:l}},A=e=>o("orders",e),z=async(e,t)=>{let r=(0,i.wP)(a.db),n=new Date,o="ORD-".concat((0,s.GP)(n,"yyyyMMdd-HHmmssSSS")),l={...e,orderNumber:o,orderDate:i.Dc.fromDate(n),createdAt:(0,i.O5)(),updatedAt:(0,i.O5)()},c=(0,i.H9)((0,i.rJ)(a.db,"orders"));for(let e of(r.set(c,l),t)){let t=(0,i.H9)(a.db,"products",e.productId),s=await (0,i.x7)(t);if(s.exists()){let a=s.data().quantity||0,n=Math.max(0,a-e.quantity);a<e.quantity&&console.warn("Stock for product ".concat(e.productId," (").concat(s.data().name,") is ").concat(a,", but trying to decrement by ").concat(e.quantity,". Setting to 0.")),r.update(t,{quantity:n,updatedAt:(0,i.O5)()})}else console.warn("Product with ID ".concat(e.productId," not found for stock decrement."))}return await r.commit(),c.id}},83686:()=>{},85057:(e,t,r)=>{"use strict";r.d(t,{J:()=>c});var a=r(95155),i=r(12115),s=r(40968),n=r(74466),o=r(59434);let l=(0,n.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),c=i.forwardRef((e,t)=>{let{className:r,...i}=e;return(0,a.jsx)(s.b,{ref:t,className:(0,o.cn)(l(),r),...i})});c.displayName=s.b.displayName},98607:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>S});var a=r(95155),i=r(51470),s=r(66695),n=r(30285),o=r(62523),l=r(85057),c=r(12543),d=r(50172),u=r(37607),m=r(87481),p=r(12115),g=r(6874),f=r.n(g),h=r(3925),y=r(60408),b=r.n(y),x=r(80410),N=r(55594);let v=N.z.object({Name:N.z.string().min(1,"Product name is required."),SerialNumber:N.z.string().optional(),Barcode:N.z.string().optional(),Price:N.z.number().min(0,"Price cannot be negative."),Quantity:N.z.number().int().min(0,"Quantity cannot be negative."),CategoryName:N.z.string().min(1,"Category name is required.")}).refine(e=>!!(e.SerialNumber||e.Barcode),{message:"Either SerialNumber or Barcode must be provided for each product."});async function w(e){let t=0,r=0,a=[],i=[],s=await (0,x.d$)(),n=new Map((await (0,x.bW)()).map(e=>[e.name.toLowerCase(),e])),o=new Map(s.filter(e=>e.serialNumber).map(e=>[e.serialNumber,e])),l=new Map(s.filter(e=>e.barcode).map(e=>[e.barcode,e]));for(let[s,u]of e.products.entries())try{var c,d;let e,m=v.safeParse(u);if(!m.success){let e=m.error.errors.map(e=>e.message).join(", ");a.push("Row ".concat(s+2,": Invalid data - ").concat(e)),r++;continue}if(isNaN(u.Price)||u.Price<0){a.push("Row ".concat(s+2,": Invalid Price '").concat(u.Price,"'. Must be a non-negative number.")),r++;continue}if(isNaN(u.Quantity)||!Number.isInteger(u.Quantity)||u.Quantity<0){a.push("Row ".concat(s+2,": Invalid Quantity '").concat(u.Quantity,"'. Must be a non-negative integer.")),r++;continue}if(!u.SerialNumber&&!u.Barcode){a.push("Row ".concat(s+2,": Missing SerialNumber and Barcode for product '").concat(u.Name,"'. Provide at least one.")),r++;continue}let p=u.CategoryName.trim().toLowerCase();if(n.has(p))e=n.get(p);else{let t=await (0,x.lw)(u.CategoryName.trim());e=t,n.set(p,t),i.includes(t.name)||i.push(t.name)}let g=null;u.SerialNumber&&(g=o.get(u.SerialNumber)||null),!g&&u.Barcode&&(g=l.get(u.Barcode)||null);let f={name:u.Name.trim(),serialNumber:(null==(c=u.SerialNumber)?void 0:c.trim())||"",barcode:(null==(d=u.Barcode)?void 0:d.trim())||"",price:u.Price,quantity:u.Quantity,categoryId:e.id,categoryName:e.name};if(g)await (0,x.vc)(g.id,f),u.SerialNumber&&g.serialNumber!==u.SerialNumber&&(o.delete(g.serialNumber),o.set(u.SerialNumber,{...g,...f})),u.Barcode&&g.barcode!==u.Barcode&&(l.delete(g.barcode),l.set(u.Barcode,{...g,...f}));else{let e={...f,imageUrl:"https://picsum.photos/seed/".concat(encodeURIComponent(f.name.split(" ")[0]),"/200/200"),imageHint:"".concat(f.name.split(" ")[0].toLowerCase()," item")},t=await (0,x.Bj)(e),r={...e,id:t};r.serialNumber&&o.set(r.serialNumber,r),r.barcode&&l.set(r.barcode,r)}t++}catch(e){console.error("Error processing product entry (Row ".concat(s+2,"): ").concat(u.Name),e),a.push("Row ".concat(s+2," (").concat(u.Name||"N/A","): ").concat(e.message||"Unknown error")),r++}let u="Bulk upload completed. ".concat(t," products processed successfully.");return r>0&&(u+=" ".concat(r," products had errors.")),i.length>0&&(u+=" Created new categories: ".concat(i.join(", "),".")),{successCount:t,errorCount:r,errors:a,newCategoriesCreated:i,message:u}}N.z.object({products:N.z.array(v)}),N.z.object({successCount:N.z.number(),errorCount:N.z.number(),errors:N.z.array(N.z.string()),newCategoriesCreated:N.z.array(N.z.string()),message:N.z.string()});let j=["owner","admin","employee"];function S(){let{toast:e}=(0,m.dj)(),[t,r]=(0,p.useState)(null),[g,y]=(0,p.useState)(!1),[x,N]=(0,p.useState)(null),v=async()=>{if(!t)return void e({title:"No File Selected",description:"Please select a file to upload.",variant:"destructive"});y(!0);try{let r=new FileReader;r.onload=async r=>{var i;let s=null==(i=r.target)?void 0:i.result;if(!s){e({title:"File Read Error",description:"Could not read the file.",variant:"destructive"}),y(!1);return}let n=[],o=["Name","SerialNumber","Barcode","Price","Quantity","CategoryName"];if(t.name.endsWith(".xlsx")){let t=h.LF(s,{type:"array"}),r=t.SheetNames[0],a=t.Sheets[r],i=h.Wp.sheet_to_json(a,{header:1});if(0===i.length){e({title:"Empty File",description:"The Excel file is empty.",variant:"destructive"}),y(!1);return}let l=i[0],c=o.filter(e=>!l.includes(e));if(c.length>0){e({title:"Missing Headers",description:"Excel file is missing headers: ".concat(c.join(", ")),variant:"destructive",duration:7e3}),y(!1);return}n=i.slice(1).map(e=>({Name:String(e[l.indexOf("Name")]||""),SerialNumber:String(e[l.indexOf("SerialNumber")]||""),Barcode:String(e[l.indexOf("Barcode")]||""),Price:parseFloat(String(e[l.indexOf("Price")]||0)),Quantity:parseInt(String(e[l.indexOf("Quantity")]||0),10),CategoryName:String(e[l.indexOf("CategoryName")]||"")}))}else if("text/csv"===t.type){let t=new TextDecoder("utf-8").decode(s),r=b().parse(t,{header:!0,skipEmptyLines:!0});if(r.errors.length>0){e({title:"CSV Parsing Error",description:"Error parsing CSV: ".concat(r.errors[0].message),variant:"destructive"}),y(!1);return}if(0===r.data.length){e({title:"Empty File",description:"The CSV file is empty or contains no data rows.",variant:"destructive"}),y(!1);return}let a=r.meta.fields||[],i=o.filter(e=>!a.includes(e));if(i.length>0){e({title:"Missing Headers",description:"CSV file is missing headers: ".concat(i.join(", ")),variant:"destructive",duration:7e3}),y(!1);return}n=r.data.map(e=>({Name:String(e.Name||""),SerialNumber:String(e.SerialNumber||""),Barcode:String(e.Barcode||""),Price:parseFloat(String(e.Price||0)),Quantity:parseInt(String(e.Quantity||0),10),CategoryName:String(e.CategoryName||"")}))}if(n=n.filter(e=>e.Name&&(e.SerialNumber||e.Barcode)&&e.CategoryName),0===n.length){e({title:"No Valid Products",description:"No valid product entries found in the file. Ensure Name, SerialNumber/Barcode, and CategoryName are present.",variant:"destructive",duration:7e3}),y(!1);return}let l=await w({products:n});l.errors&&l.errors.length>0?e({title:"Bulk Upload Partially Successful (".concat(l.successCount," / ").concat(n.length,")"),description:(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{children:l.message}),l.newCategoriesCreated&&l.newCategoriesCreated.length>0&&(0,a.jsxs)("p",{children:["New categories created: ",l.newCategoriesCreated.join(", ")]}),(0,a.jsx)("p",{className:"font-semibold mt-2",children:"Errors:"}),(0,a.jsxs)("ul",{className:"list-disc list-inside max-h-32 overflow-y-auto text-xs",children:[l.errors.slice(0,5).map((e,t)=>(0,a.jsx)("li",{children:e},t)),l.errors.length>5&&(0,a.jsxs)("li",{children:["...and ",l.errors.length-5," more."]})]})]}),variant:"destructive",duration:1e4}):e({title:"Bulk Upload Successful!",description:(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{children:[l.message," Processed ",l.successCount," products."]}),l.newCategoriesCreated&&l.newCategoriesCreated.length>0&&(0,a.jsxs)("p",{children:["New categories created: ",l.newCategoriesCreated.join(", ")]})]}),className:"bg-green-500 text-white",duration:7e3})},r.onerror=()=>{e({title:"File Read Error",description:"An error occurred while reading the file.",variant:"destructive"}),y(!1)},r.readAsArrayBuffer(t)}catch(t){console.error("Error during upload process:",t),e({title:"Upload Error",description:"An unexpected error occurred during upload.",variant:"destructive"})}finally{let e=document.getElementById("bulk-product-file");e&&(e.value=""),r(null),N(null),y(!1)}};return(0,a.jsx)(i.default,{allowedRoles:j,children:(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)(n.$,{variant:"outline",size:"sm",asChild:!0,children:(0,a.jsxs)(f(),{href:"/products",children:[(0,a.jsx)(c.A,{className:"mr-2 h-4 w-4"})," Back to Products"]})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold tracking-tight text-primary",children:"Bulk Product Upload"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Upload an Excel (xlsx) or CSV file containing product information."})]}),(0,a.jsxs)(s.Zp,{className:"shadow-md",children:[(0,a.jsxs)(s.aR,{children:[(0,a.jsx)(s.ZB,{className:"text-lg",children:"Upload File"}),(0,a.jsxs)(s.BT,{children:["Ensure your file has columns: ",(0,a.jsx)("span",{className:"font-semibold",children:"Name, SerialNumber, Barcode, Price, Quantity, CategoryName"}),".",(0,a.jsx)("br",{}),"If a CategoryName does not exist, it will be created automatically. Price and Quantity should be numbers."]})]}),(0,a.jsxs)(s.Wu,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid w-full max-w-sm items-center gap-1.5",children:[(0,a.jsx)(l.J,{htmlFor:"bulk-product-file",children:"Product File (CSV or XLSX)"}),(0,a.jsx)(o.p,{id:"bulk-product-file",type:"file",accept:".csv, .xlsx, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",onChange:t=>{if(t.target.files&&t.target.files[0]){let a=t.target.files[0];"text/csv"===a.type||a.name.endsWith(".xlsx")||"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"===a.type?(r(a),N(a.name)):(e({title:"Invalid File Type",description:"Please upload a CSV or Excel (.xlsx) file.",variant:"destructive"}),r(null),N(null),t.target.value="")}else r(null),N(null)},disabled:g}),x&&(0,a.jsxs)("p",{className:"text-sm text-muted-foreground mt-1",children:["Selected: ",x]})]}),(0,a.jsxs)(n.$,{onClick:v,disabled:!t||g,className:"bg-accent hover:bg-accent/90 text-accent-foreground",children:[g?(0,a.jsx)(d.A,{className:"mr-2 h-5 w-5 animate-spin"}):(0,a.jsx)(u.A,{className:"mr-2 h-5 w-5"}),g?"Processing...":"Upload Products"]})]})]})]})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[2992,9855,3524,9701,3013,6874,5589,7629,8970,8441,1684,7358],()=>t(40507)),_N_E=e.O()}]);