(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2257],{14636:(e,t,a)=>{"use strict";a.d(t,{AM:()=>n,Wv:()=>i,hl:()=>l});var r=a(95155),s=a(12115),o=a(38427),d=a(59434);let n=o.bL,i=o.l9,l=s.forwardRef((e,t)=>{let{className:a,align:s="center",sideOffset:n=4,...i}=e;return(0,r.jsx)(o.ZL,{children:(0,r.jsx)(o.UC,{ref:t,align:s,sideOffset:n,className:(0,d.cn)("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...i})})});l.displayName=o.UC.displayName},31393:(e,t,a)=>{Promise.resolve().then(a.bind(a,68169))},51470:(e,t,a)=>{"use strict";a.d(t,{default:()=>l});var r=a(95155),s=a(66681),o=a(35695),d=a(12115),n=a(68856);let i=()=>(0,r.jsxs)("div",{className:"space-y-6 p-4",children:[(0,r.jsx)(n.E,{className:"h-10 w-1/3"}),(0,r.jsx)(n.E,{className:"h-8 w-1/2"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,r.jsx)(n.E,{className:"h-40 w-full"}),(0,r.jsx)(n.E,{className:"h-40 w-full"})]}),(0,r.jsx)(n.E,{className:"h-60 w-full"})]});function l(e){let{children:t,allowedRoles:a,redirectPath:n="/login"}=e,{currentUser:l,userProfile:c,isLoading:u}=(0,s.A)(),m=(0,o.useRouter)(),h=(0,o.usePathname)(),[f,x]=(0,d.useState)(!1);return((0,d.useEffect)(()=>{let e=!1;u||(l?a&&a.length>0?c&&a.includes(c.role)?e=!0:"/"!==h&&m.replace("/"):e=!0:h!==n?m.replace(n):e=!0),f!==e&&x(e)},[l,c,u,m,a,n,h]),u)?(0,r.jsx)(i,{}):f?(0,r.jsx)(r.Fragment,{children:t}):(0,r.jsx)(i,{})}},68169:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>A});var r=a(95155),s=a(51470),o=a(66695),d=a(30285),n=a(12543),i=a(51920),l=a(50172),c=a(68718),u=a(87481),m=a(12115),h=a(6874),f=a.n(h),x=a(14636),p=a(85511),y=a(78816),g=a(83013),w=a(80410),b=a(60408),v=a.n(b);let N=e=>{let t;if(!e)return"N/A";if(e instanceof Date)t=e;else if("function"==typeof(null==e?void 0:e.toDate))t=e.toDate();else{if("string"!=typeof e)return"Invalid Date";t=new Date(e)}return isNaN(t.getTime())?"Invalid Date":(0,g.GP)(t,"yyyy-MM-dd HH:mm:ss")};async function j(e){try{let t=(await (0,w.WF)()).filter(t=>{var a;if(!(null==e?void 0:e.from))return!0;let r=t.orderDate instanceof Date?t.orderDate:(null==(a=t.orderDate)?void 0:a.toDate)?t.orderDate.toDate():new Date(t.orderDate);if(isNaN(r.getTime()))return!1;let s=new Date(e.from);if(s.setHours(0,0,0,0),e.to){let t=new Date(e.to);return t.setHours(23,59,59,999),r>=s&&r<=t}return r>=s}),a=[];if(t.forEach(e=>{e.items.forEach(t=>{a.push({"Order Number":e.orderNumber,"Order Date":N(e.orderDate),"Customer Name":e.customerName,"Customer Mobile":e.customerMobile,"Customer Address":e.customerAddress||"N/A","Item Name":t.name,"Item SN/Barcode":t.serialNumber||t.barcode||"N/A","Item Price (INR)":t.price.toFixed(2),"Item Quantity":t.billQuantity,"Item Subtotal (INR)":(t.price*t.billQuantity).toFixed(2),"Order Subtotal (INR)":e.subtotal.toFixed(2),"Order Tax (INR)":e.taxAmount.toFixed(2),"Order Total (INR)":e.totalAmount.toFixed(2)})})}),0===a.length)return"";return v().unparse(a)}catch(e){throw console.error("Error exporting orders to CSV:",e),Error("Failed to export orders.")}}let D=["owner"];function A(){let{toast:e}=(0,u.dj)(),[t,a]=(0,m.useState)(!1),[h,w]=(0,m.useState)({from:(0,y.e)(new Date,29),to:new Date}),b=async()=>{a(!0);try{let t=await j(h);if(!t){e({title:"No Data to Export",description:"No orders found for the selected date range."}),a(!1);return}let r=new Blob([t],{type:"text/csv;charset=utf-8;"}),s=document.createElement("a"),o=URL.createObjectURL(r);s.setAttribute("href",o),s.setAttribute("download","PAS_Trading_CO_Orders_".concat((0,g.GP)(new Date,"yyyyMMdd_HHmmss"),".csv")),s.style.visibility="hidden",document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(o),e({title:"Export Successful",description:"Orders ".concat((null==h?void 0:h.from)?"from ".concat((0,g.GP)(h.from,"LLL dd, y")):"all"," to ").concat((null==h?void 0:h.to)?(0,g.GP)(h.to,"LLL dd, y"):"today"," have been exported."),className:"bg-green-500 text-white"})}catch(t){console.error("Error exporting orders:",t),e({title:"Export Failed",description:t.message||"Could not export orders. Please try again.",variant:"destructive"})}a(!1)};return(0,r.jsx)(s.default,{allowedRoles:D,children:(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)(d.$,{variant:"outline",size:"sm",asChild:!0,children:(0,r.jsxs)(f(),{href:"/orders",children:[(0,r.jsx)(n.A,{className:"mr-2 h-4 w-4"})," Back to Orders"]})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-3xl font-bold tracking-tight text-primary",children:"Export Orders"}),(0,r.jsx)("p",{className:"text-muted-foreground",children:"Download order history as a CSV file."})]}),(0,r.jsxs)(o.Zp,{className:"shadow-md",children:[(0,r.jsxs)(o.aR,{children:[(0,r.jsx)(o.ZB,{className:"text-lg",children:"Select Date Range"}),(0,r.jsx)(o.BT,{children:"Choose the period for which you want to export orders. Exports all orders if no range is selected."})]}),(0,r.jsxs)(o.Wu,{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)(x.AM,{children:[(0,r.jsx)(x.Wv,{asChild:!0,children:(0,r.jsxs)(d.$,{variant:"outline",className:"w-full sm:w-[280px] justify-start text-left font-normal ".concat(!h&&"text-muted-foreground"),children:[(0,r.jsx)(i.A,{className:"mr-2 h-4 w-4"}),(null==h?void 0:h.from)?h.to?(0,r.jsxs)(r.Fragment,{children:[(0,g.GP)(h.from,"LLL dd, y")," -"," ",(0,g.GP)(h.to,"LLL dd, y")]}):(0,g.GP)(h.from,"LLL dd, y"):(0,r.jsx)("span",{children:"Pick a date range"})]})}),(0,r.jsx)(x.hl,{className:"w-auto p-0",align:"start",children:(0,r.jsx)(p.V,{initialFocus:!0,mode:"range",defaultMonth:null==h?void 0:h.from,selected:h,onSelect:w,numberOfMonths:2})})]}),(0,r.jsx)(d.$,{variant:"ghost",size:"sm",onClick:()=>w(void 0),className:"ml-2 text-xs text-muted-foreground hover:text-primary",children:"Clear Range (Export All)"})]}),(0,r.jsxs)(d.$,{onClick:b,disabled:t,className:"bg-accent hover:bg-accent/90 text-accent-foreground",children:[t?(0,r.jsx)(l.A,{className:"mr-2 h-5 w-5 animate-spin"}):(0,r.jsx)(c.A,{className:"mr-2 h-5 w-5"}),t?"Exporting...":"Export Orders to CSV"]})]})]})]})})}},80410:(e,t,a)=>{"use strict";a.d(t,{Ah:()=>m,Bj:()=>w,DD:()=>v,Gk:()=>A,K7:()=>f,WF:()=>E,bD:()=>O,bW:()=>u,d$:()=>p,hA:()=>L,iB:()=>y,lw:()=>x,od:()=>N,oo:()=>g,r$:()=>P,st:()=>h,uq:()=>C,vc:()=>b,w0:()=>_,xt:()=>j,yw:()=>D});var r=a(56104),s=a(35317),o=a(83013);let d=async function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"asc",o=arguments.length>3?arguments[3]:void 0,d=arguments.length>4?arguments[4]:void 0,n=arguments.length>5?arguments[5]:void 0,i=(0,s.P)((0,s.rJ)(r.db,e));t&&(i=(0,s.P)(i,(0,s.My)(t,a))),o&&o>0&&(i=d?(0,s.P)(i,(0,s.HM)(d),(0,s.AB)(o)):n?(0,s.P)(i,(0,s.rf)(n),(0,s.$1)(o)):(0,s.P)(i,(0,s.AB)(o)));let l=await (0,s.GG)(i);return{data:l.docs.map(e=>({id:e.id,...e.data()})),firstDoc:l.docs.length>0?l.docs[0]:null,lastDoc:l.docs.length>0?l.docs[l.docs.length-1]:null}},n=async(e,t)=>{let a=(0,s.H9)(r.db,e,t),o=await (0,s.x7)(a);return o.exists()?{id:o.id,...o.data()}:null},i=async(e,t)=>(await (0,s.gS)((0,s.rJ)(r.db,e),{...t,createdAt:(0,s.O5)(),updatedAt:(0,s.O5)()})).id,l=async(e,t,a)=>{let o=(0,s.H9)(r.db,e,t);await (0,s.mZ)(o,{...a,updatedAt:(0,s.O5)()})},c=async(e,t)=>{await (0,s.kd)((0,s.H9)(r.db,e,t))},u=async()=>{let{data:e}=await d("categories","name");return e},m=async e=>{let t=await i("categories",e),a=s.Dc.now();return{id:t,...e,createdAt:a,updatedAt:a}},h=(e,t)=>l("categories",e,t),f=e=>c("categories",e),x=async e=>{let t=e.trim(),a=(0,s.P)((0,s.rJ)(r.db,"categories"),(0,s._M)("name","==",t),(0,s.AB)(1)),o=await (0,s.GG)(a);if(o.empty)return m({name:t});{let e=o.docs[0];return{id:e.id,...e.data()}}},p=async()=>{let{data:e}=await d("products","name");return e},y=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"name",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"asc",r=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0,{data:o,firstDoc:n,lastDoc:i}=await d("products",t,a,e,r,s);return{products:o,firstDoc:n,lastDoc:i}},g=e=>n("products",e),w=e=>i("products",e),b=(e,t)=>l("products",e,t),v=e=>c("products",e),N=async()=>{let{data:e}=await d("customers","name");return e},j=e=>n("customers",e),D=e=>i("customers",e),A=(e,t)=>l("customers",e,t),_=e=>c("customers",e),O=async e=>{let t=(0,s.P)((0,s.rJ)(r.db,"customers"),(0,s._M)("mobileNumber","==",e));return(await (0,s.GG)(t)).docs.map(e=>({id:e.id,...e.data()}))},E=async()=>{let{data:e}=await d("orders","orderDate","desc");return e},L=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"orderDate",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"desc",r=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0,{data:o,firstDoc:n,lastDoc:i}=await d("orders",t,a,e,r,s);return{orders:o,firstDoc:n,lastDoc:i}},P=e=>n("orders",e),C=async(e,t)=>{let a=(0,s.wP)(r.db),d=new Date,n="ORD-".concat((0,o.GP)(d,"yyyyMMdd-HHmmssSSS")),i={...e,orderNumber:n,orderDate:s.Dc.fromDate(d),createdAt:(0,s.O5)(),updatedAt:(0,s.O5)()},l=(0,s.H9)((0,s.rJ)(r.db,"orders"));for(let e of(a.set(l,i),t)){let t=(0,s.H9)(r.db,"products",e.productId),o=await (0,s.x7)(t);if(o.exists()){let r=o.data().quantity||0,d=Math.max(0,r-e.quantity);r<e.quantity&&console.warn("Stock for product ".concat(e.productId," (").concat(o.data().name,") is ").concat(r,", but trying to decrement by ").concat(e.quantity,". Setting to 0.")),a.update(t,{quantity:d,updatedAt:(0,s.O5)()})}else console.warn("Product with ID ".concat(e.productId," not found for stock decrement."))}return await a.commit(),l.id}},85511:(e,t,a)=>{"use strict";a.d(t,{V:()=>l});var r=a(95155);a(12115);var s=a(965),o=a(73158),d=a(37466),n=a(59434),i=a(30285);function l(e){let{className:t,classNames:a,showOutsideDays:l=!0,...c}=e;return(0,r.jsx)(d.hv,{showOutsideDays:l,className:(0,n.cn)("p-3",t),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:(0,n.cn)((0,i.r)({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:(0,n.cn)((0,i.r)({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...a},components:{IconLeft:e=>{let{className:t,...a}=e;return(0,r.jsx)(s.A,{className:(0,n.cn)("h-4 w-4",t),...a})},IconRight:e=>{let{className:t,...a}=e;return(0,r.jsx)(o.A,{className:(0,n.cn)("h-4 w-4",t),...a})}},...c})}l.displayName="Calendar"}},e=>{var t=t=>e(e.s=t);e.O(0,[2992,9855,9701,3013,5209,6874,3647,7759,7629,8970,8441,1684,7358],()=>t(31393)),_N_E=e.O()}]);