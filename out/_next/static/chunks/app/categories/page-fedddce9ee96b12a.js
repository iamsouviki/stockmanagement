(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2379],{5845:(e,t,a)=>{"use strict";a.d(t,{i:()=>n});var s=a(12115),r=a(39033);function n({prop:e,defaultProp:t,onChange:a=()=>{}}){let[n,l]=function({defaultProp:e,onChange:t}){let a=s.useState(e),[n]=a,l=s.useRef(n),c=(0,r.c)(t);return s.useEffect(()=>{l.current!==n&&(c(n),l.current=n)},[n,l,c]),a}({defaultProp:t,onChange:a}),c=void 0!==e,i=c?e:n,d=(0,r.c)(a);return[i,s.useCallback(t=>{if(c){let a="function"==typeof t?t(e):t;a!==e&&d(a)}else l(t)},[c,e,l,d])]}},6836:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>P});var s=a(95155),r=a(12115),n=a(30285),l=a(85127),c=a(14675),i=a(75943),d=a(77223),o=a(90010),m=a(66424),u=a(66695),x=a(83013),h=a(35317);let p=e=>{let{categories:t,onEdit:a,onDelete:r,searchTerm:p}=e,y=e=>{let t;if(!e)return"N/A";if(e instanceof h.Dc)try{t=e.toDate()}catch(t){return console.error("Error converting Firestore Timestamp in CategoryTable:",t,e),"Invalid Date"}else if(e instanceof Date)t=e;else if("string"==typeof e)t=new Date(e);else if("function"!=typeof(null==e?void 0:e.toDate))return console.warn("Unformattable dateValue type in CategoryTable:",typeof e,e),"Invalid Date";else try{t=e.toDate()}catch(t){return console.error("Error formatting object with toDate() in CategoryTable:",t,e),"Invalid Date"}try{if(isNaN(t.getTime()))return console.warn("Invalid Date object after conversion in CategoryTable:",t,"Original:",e),"Invalid Date";return(0,x.GP)(t,"PPp")}catch(e){return console.error("Error formatting final Date object in CategoryTable:",e,t),"Invalid Date"}};return(0,s.jsxs)(u.Zp,{className:"shadow-lg",children:[(0,s.jsxs)(u.aR,{children:[(0,s.jsx)(u.ZB,{className:"text-lg sm:text-xl text-primary",children:"Category List"}),(0,s.jsx)(u.BT,{className:"text-sm sm:text-base",children:"All available product categories."})]}),(0,s.jsx)(u.Wu,{children:(0,s.jsxs)(m.F,{className:"w-full whitespace-nowrap rounded-md border",children:[(0,s.jsxs)(l.XI,{className:"min-w-[600px] sm:min-w-full",children:[(0,s.jsx)(l.A0,{children:(0,s.jsxs)(l.Hj,{children:[(0,s.jsx)(l.nd,{className:"w-[60px] sm:w-[80px] px-2 sm:px-4",children:"Icon"}),(0,s.jsx)(l.nd,{className:"px-2 sm:px-4",children:"Name"}),(0,s.jsx)(l.nd,{className:"px-2 sm:px-4",children:"Created At"}),(0,s.jsx)(l.nd,{className:"px-2 sm:px-4",children:"Last Updated"}),(0,s.jsx)(l.nd,{className:"text-center w-[100px] sm:w-[120px] px-2 sm:px-4",children:"Actions"})]})}),(0,s.jsx)(l.BF,{children:0===t.length?(0,s.jsx)(l.Hj,{children:(0,s.jsx)(l.nA,{colSpan:5,className:"h-24 text-center text-sm sm:text-base",children:p?"No categories match your search.":"No categories found. Add new categories to see them here."})}):t.map(e=>(0,s.jsxs)(l.Hj,{children:[(0,s.jsx)(l.nA,{className:"px-2 sm:px-4",children:(0,s.jsx)("div",{className:"w-8 h-8 sm:w-10 sm:h-10 bg-secondary rounded-md flex items-center justify-center",children:(0,s.jsx)(c.A,{className:"h-4 w-4 sm:h-5 sm:w-5 text-muted-foreground"})})}),(0,s.jsx)(l.nA,{className:"font-medium text-xs sm:text-sm px-2 sm:px-4 whitespace-normal break-words",children:e.name}),(0,s.jsx)(l.nA,{className:"text-xs sm:text-sm px-2 sm:px-4",children:y(e.createdAt)}),(0,s.jsx)(l.nA,{className:"text-xs sm:text-sm px-2 sm:px-4",children:y(e.updatedAt)}),(0,s.jsx)(l.nA,{className:"text-center px-2 sm:px-4",children:(0,s.jsxs)("div",{className:"flex justify-center space-x-1 sm:space-x-2",children:[(0,s.jsx)(n.$,{variant:"ghost",size:"icon",className:"h-7 w-7 sm:h-8 sm:w-8",onClick:()=>a(e),title:"Edit Category",children:(0,s.jsx)(i.A,{className:"h-3 w-3 sm:h-4 sm:w-4 text-blue-600"})}),(0,s.jsxs)(o.Lt,{children:[(0,s.jsx)(o.tv,{asChild:!0,children:(0,s.jsx)(n.$,{variant:"ghost",size:"icon",className:"h-7 w-7 sm:h-8 sm:w-8",title:"Delete Category",children:(0,s.jsx)(d.A,{className:"h-3 w-3 sm:h-4 sm:w-4 text-red-600"})})}),(0,s.jsxs)(o.EO,{children:[(0,s.jsxs)(o.wd,{children:[(0,s.jsx)(o.r7,{children:"Are you sure?"}),(0,s.jsxs)(o.$v,{children:['This action cannot be undone. This will permanently delete the category "',e.name,'". Products using this category will need to be reassigned.']})]}),(0,s.jsxs)(o.ck,{children:[(0,s.jsx)(o.Zr,{children:"Cancel"}),(0,s.jsx)(o.Rx,{onClick:()=>r(e.id),className:"bg-destructive hover:bg-destructive/90",children:"Delete"})]})]})]})]})})]},e.id))})]}),(0,s.jsx)(m.$,{orientation:"horizontal"})]})})]})};var y=a(54165),f=a(62177),g=a(90221),j=a(55594),w=a(17759),b=a(62523);let v=j.Ik({name:j.Yj().min(2,"Category name must be at least 2 characters.").max(50,"Category name must be 50 characters or less.")}),N=e=>{let{category:t,onSubmit:a,onCancel:r}=e,l=(0,f.mN)({resolver:(0,g.u)(v),defaultValues:t?{name:t.name}:{name:""}});return(0,s.jsx)(w.lV,{...l,children:(0,s.jsxs)("form",{onSubmit:l.handleSubmit(a),className:"space-y-6 py-4",children:[(0,s.jsx)(w.zB,{control:l.control,name:"name",render:e=>{let{field:t}=e;return(0,s.jsxs)(w.eI,{children:[(0,s.jsx)(w.lR,{children:"Category Name"}),(0,s.jsx)(w.MJ,{children:(0,s.jsx)(b.p,{placeholder:"e.g., Smartphones, Laptops",...t})}),(0,s.jsx)(w.C5,{})]})}}),(0,s.jsxs)("div",{className:"flex justify-end space-x-3 pt-4",children:[(0,s.jsx)(n.$,{type:"button",variant:"outline",onClick:r,children:"Cancel"}),(0,s.jsx)(n.$,{type:"submit",className:"bg-primary hover:bg-primary/90",children:t?"Update Category":"Add Category"})]})]})})},A=e=>{let{isOpen:t,onOpenChange:a,category:r,onSubmit:n}=e;return(0,s.jsx)(y.lG,{open:t,onOpenChange:a,children:(0,s.jsxs)(y.Cf,{className:"w-full max-w-md sm:max-w-lg md:max-w-[425px]",children:[(0,s.jsxs)(y.c7,{children:[(0,s.jsx)(y.L3,{className:"text-xl sm:text-2xl font-semibold text-primary",children:r?"Edit Category":"Add New Category"}),(0,s.jsx)(y.rr,{className:"text-xs sm:text-sm",children:r?"Update the name for this category.":"Enter the name for the new category."})]}),(0,s.jsx)(N,{category:r,onSubmit:e=>{n(e)},onCancel:()=>a(!1)})]})})};var C=a(34301),D=a(75074),E=a(87481),k=a(80410),S=a(68856),I=a(51470);let O=["owner","admin","employee"];function P(){let[e,t]=(0,r.useState)([]),[a,l]=(0,r.useState)(!1),[i,d]=(0,r.useState)(null),[o,m]=(0,r.useState)(!0),[u,x]=(0,r.useState)(""),{toast:h}=(0,E.dj)();(0,r.useEffect)(()=>{(async()=>{m(!0);try{let e=await (0,k.bW)();t(e)}catch(e){console.error("Error fetching categories:",e),h({title:"Error",description:"Failed to fetch categories.",variant:"destructive"})}m(!1)})()},[h]);let y=async a=>{try{await (0,k.K7)(a),t(e.filter(e=>e.id!==a)),h({title:"Category Deleted",description:"The category has been successfully removed.",variant:"destructive"})}catch(e){console.error("Error deleting category:",e),h({title:"Error",description:"Failed to delete category. It might be in use by products.",variant:"destructive"})}},f=async a=>{try{if(e.some(e=>e.name.toLowerCase()===a.name.toLowerCase()&&(!i||e.id!==i.id)))return void h({title:"Duplicate Category",description:'A category named "'.concat(a.name,'" already exists.'),variant:"destructive"});if(i){await (0,k.st)(i.id,a);let e=await (0,k.bW)();t(e),h({title:"Category Updated",description:'Category "'.concat(a.name,'" has been successfully updated.')})}else{await (0,k.Ah)(a);let e=await (0,k.bW)();t(e),h({title:"Category Added",description:'Category "'.concat(a.name,'" has been successfully added.')})}l(!1),d(null)}catch(e){console.error("Error saving category:",e),h({title:"Error",description:"Failed to save category.",variant:"destructive"})}},g=(0,r.useMemo)(()=>{if(!u)return e;let t=u.toLowerCase();return e.filter(e=>e.name.toLowerCase().includes(t))},[e,u]);return(0,s.jsx)(I.default,{allowedRoles:O,children:(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("h1",{className:"text-3xl font-bold tracking-tight text-primary flex items-center",children:[(0,s.jsx)(c.A,{className:"mr-3 h-8 w-8"})," Category Management"]}),(0,s.jsx)("p",{className:"text-muted-foreground",children:"Organize your products by adding and managing categories."})]}),(0,s.jsxs)(n.$,{onClick:()=>{d(null),l(!0)},className:"bg-primary hover:bg-primary/90 w-full sm:w-auto",children:[(0,s.jsx)(C.A,{className:"mr-2 h-5 w-5"})," Add New Category"]})]}),(0,s.jsxs)("div",{className:"relative mt-2 sm:w-72",children:[(0,s.jsx)(D.A,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-muted-foreground"}),(0,s.jsx)(b.p,{type:"text",placeholder:"Filter categories by name...",value:u,onChange:e=>x(e.target.value),className:"pl-10 w-full text-sm","aria-label":"Filter categories by name"})]}),o?(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)(S.E,{className:"h-12 w-full"}),(0,s.jsx)(S.E,{className:"h-16 w-full"}),(0,s.jsx)(S.E,{className:"h-16 w-full"})]}):(0,s.jsx)(p,{categories:g,onEdit:e=>{d(e),l(!0)},onDelete:y,searchTerm:u}),(0,s.jsx)(A,{isOpen:a,onOpenChange:l,category:i,onSubmit:f})]})})}},14675:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(40157).A)("Tags",[["path",{d:"m15 5 6.3 6.3a2.4 2.4 0 0 1 0 3.4L17 19",key:"1cbfv1"}],["path",{d:"M9.586 5.586A2 2 0 0 0 8.172 5H3a1 1 0 0 0-1 1v5.172a2 2 0 0 0 .586 1.414L8.29 18.29a2.426 2.426 0 0 0 3.42 0l3.58-3.58a2.426 2.426 0 0 0 0-3.42z",key:"135mg7"}],["circle",{cx:"6.5",cy:"9.5",r:".5",fill:"currentColor",key:"5pm5xn"}]])},19901:(e,t,a)=>{Promise.resolve().then(a.bind(a,6836))},61285:(e,t,a)=>{"use strict";a.d(t,{B:()=>i});var s,r=a(12115),n=a(52712),l=(s||(s=a.t(r,2)))["useId".toString()]||(()=>void 0),c=0;function i(e){let[t,a]=r.useState(l());return(0,n.N)(()=>{e||a(e=>e??String(c++))},[e]),e||(t?`radix-${t}`:"")}},75074:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(40157).A)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]])},80410:(e,t,a)=>{"use strict";a.d(t,{Ah:()=>u,Bj:()=>j,DD:()=>b,Gk:()=>C,K7:()=>h,WF:()=>k,bD:()=>E,bW:()=>m,d$:()=>y,hA:()=>S,iB:()=>f,lw:()=>p,od:()=>v,oo:()=>g,r$:()=>I,st:()=>x,uq:()=>O,vc:()=>w,w0:()=>D,xt:()=>N,yw:()=>A});var s=a(56104),r=a(35317),n=a(83013);let l=async function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"asc",n=arguments.length>3?arguments[3]:void 0,l=arguments.length>4?arguments[4]:void 0,c=arguments.length>5?arguments[5]:void 0,i=(0,r.P)((0,r.rJ)(s.db,e));t&&(i=(0,r.P)(i,(0,r.My)(t,a))),n&&n>0&&(i=l?(0,r.P)(i,(0,r.HM)(l),(0,r.AB)(n)):c?(0,r.P)(i,(0,r.rf)(c),(0,r.$1)(n)):(0,r.P)(i,(0,r.AB)(n)));let d=await (0,r.GG)(i);return{data:d.docs.map(e=>({id:e.id,...e.data()})),firstDoc:d.docs.length>0?d.docs[0]:null,lastDoc:d.docs.length>0?d.docs[d.docs.length-1]:null}},c=async(e,t)=>{let a=(0,r.H9)(s.db,e,t),n=await (0,r.x7)(a);return n.exists()?{id:n.id,...n.data()}:null},i=async(e,t)=>(await (0,r.gS)((0,r.rJ)(s.db,e),{...t,createdAt:(0,r.O5)(),updatedAt:(0,r.O5)()})).id,d=async(e,t,a)=>{let n=(0,r.H9)(s.db,e,t);await (0,r.mZ)(n,{...a,updatedAt:(0,r.O5)()})},o=async(e,t)=>{await (0,r.kd)((0,r.H9)(s.db,e,t))},m=async()=>{let{data:e}=await l("categories","name");return e},u=async e=>{let t=await i("categories",e),a=r.Dc.now();return{id:t,...e,createdAt:a,updatedAt:a}},x=(e,t)=>d("categories",e,t),h=e=>o("categories",e),p=async e=>{let t=e.trim(),a=(0,r.P)((0,r.rJ)(s.db,"categories"),(0,r._M)("name","==",t),(0,r.AB)(1)),n=await (0,r.GG)(a);if(n.empty)return u({name:t});{let e=n.docs[0];return{id:e.id,...e.data()}}},y=async()=>{let{data:e}=await l("products","name");return e},f=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"name",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"asc",s=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0,{data:n,firstDoc:c,lastDoc:i}=await l("products",t,a,e,s,r);return{products:n,firstDoc:c,lastDoc:i}},g=e=>c("products",e),j=e=>i("products",e),w=(e,t)=>d("products",e,t),b=e=>o("products",e),v=async()=>{let{data:e}=await l("customers","name");return e},N=e=>c("customers",e),A=e=>i("customers",e),C=(e,t)=>d("customers",e,t),D=e=>o("customers",e),E=async e=>{let t=(0,r.P)((0,r.rJ)(s.db,"customers"),(0,r._M)("mobileNumber","==",e));return(await (0,r.GG)(t)).docs.map(e=>({id:e.id,...e.data()}))},k=async()=>{let{data:e}=await l("orders","orderDate","desc");return e},S=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"orderDate",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"desc",s=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0,{data:n,firstDoc:c,lastDoc:i}=await l("orders",t,a,e,s,r);return{orders:n,firstDoc:c,lastDoc:i}},I=e=>c("orders",e),O=async(e,t)=>{let a=(0,r.wP)(s.db),l=new Date,c="ORD-".concat((0,n.GP)(l,"yyyyMMdd-HHmmssSSS")),i={...e,orderNumber:c,orderDate:r.Dc.fromDate(l),createdAt:(0,r.O5)(),updatedAt:(0,r.O5)()},d=(0,r.H9)((0,r.rJ)(s.db,"orders"));for(let e of(a.set(d,i),t)){let t=(0,r.H9)(s.db,"products",e.productId),n=await (0,r.x7)(t);if(n.exists()){let s=n.data().quantity||0,l=Math.max(0,s-e.quantity);s<e.quantity&&console.warn("Stock for product ".concat(e.productId," (").concat(n.data().name,") is ").concat(s,", but trying to decrement by ").concat(e.quantity,". Setting to 0.")),a.update(t,{quantity:l,updatedAt:(0,r.O5)()})}else console.warn("Product with ID ".concat(e.productId," not found for stock decrement."))}return await a.commit(),d.id}},90010:(e,t,a)=>{"use strict";a.d(t,{$v:()=>y,EO:()=>u,Lt:()=>i,Rx:()=>f,Zr:()=>g,ck:()=>h,r7:()=>p,tv:()=>d,wd:()=>x});var s=a(95155),r=a(12115),n=a(61378),l=a(59434),c=a(30285);let i=n.bL,d=n.l9,o=n.ZL,m=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(n.hJ,{className:(0,l.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...r,ref:t})});m.displayName=n.hJ.displayName;let u=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsxs)(o,{children:[(0,s.jsx)(m,{}),(0,s.jsx)(n.UC,{ref:t,className:(0,l.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...r})]})});u.displayName=n.UC.displayName;let x=e=>{let{className:t,...a}=e;return(0,s.jsx)("div",{className:(0,l.cn)("flex flex-col space-y-2 text-center sm:text-left",t),...a})};x.displayName="AlertDialogHeader";let h=e=>{let{className:t,...a}=e;return(0,s.jsx)("div",{className:(0,l.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...a})};h.displayName="AlertDialogFooter";let p=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(n.hE,{ref:t,className:(0,l.cn)("text-lg font-semibold",a),...r})});p.displayName=n.hE.displayName;let y=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(n.VY,{ref:t,className:(0,l.cn)("text-sm text-muted-foreground",a),...r})});y.displayName=n.VY.displayName;let f=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(n.rc,{ref:t,className:(0,l.cn)((0,c.r)(),a),...r})});f.displayName=n.rc.displayName;let g=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(n.ZD,{ref:t,className:(0,l.cn)((0,c.r)({variant:"outline"}),"mt-2 sm:mt-0",a),...r})});g.displayName=n.ZD.displayName},92293:(e,t,a)=>{"use strict";a.d(t,{Oh:()=>n});var s=a(12115),r=0;function n(){s.useEffect(()=>{var e,t;let a=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",null!=(e=a[0])?e:l()),document.body.insertAdjacentElement("beforeend",null!=(t=a[1])?t:l()),r++,()=>{1===r&&document.querySelectorAll("[data-radix-focus-guard]").forEach(e=>e.remove()),r--}},[])}function l(){let e=document.createElement("span");return e.setAttribute("data-radix-focus-guard",""),e.tabIndex=0,e.style.outline="none",e.style.opacity="0",e.style.position="fixed",e.style.pointerEvents="none",e}}},e=>{var t=t=>e(e.s=t);e.O(0,[2992,9855,9701,3013,5209,5589,7655,221,2882,6916,8970,8469,8441,1684,7358],()=>t(19901)),_N_E=e.O()}]);