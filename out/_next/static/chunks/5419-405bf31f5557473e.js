"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5419],{80410:(e,t,r)=>{r.d(t,{Ah:()=>u,Bj:()=>y,DD:()=>w,Gk:()=>C,K7:()=>b,WF:()=>k,bD:()=>M,bW:()=>m,d$:()=>p,hA:()=>I,iB:()=>j,lw:()=>h,od:()=>N,oo:()=>g,r$:()=>S,st:()=>x,uq:()=>J,vc:()=>f,w0:()=>D,xt:()=>v,yw:()=>A});var a=r(56104),s=r(35317),n=r(83013);let d=async function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"asc",n=arguments.length>3?arguments[3]:void 0,d=arguments.length>4?arguments[4]:void 0,l=arguments.length>5?arguments[5]:void 0,o=(0,s.P)((0,s.rJ)(a.db,e));t&&(o=(0,s.P)(o,(0,s.My)(t,r))),n&&n>0&&(o=d?(0,s.P)(o,(0,s.HM)(d),(0,s.AB)(n)):l?(0,s.P)(o,(0,s.rf)(l),(0,s.$1)(n)):(0,s.P)(o,(0,s.AB)(n)));let i=await (0,s.GG)(o);return{data:i.docs.map(e=>({id:e.id,...e.data()})),firstDoc:i.docs.length>0?i.docs[0]:null,lastDoc:i.docs.length>0?i.docs[i.docs.length-1]:null}},l=async(e,t)=>{let r=(0,s.H9)(a.db,e,t),n=await (0,s.x7)(r);return n.exists()?{id:n.id,...n.data()}:null},o=async(e,t)=>(await (0,s.gS)((0,s.rJ)(a.db,e),{...t,createdAt:(0,s.O5)(),updatedAt:(0,s.O5)()})).id,i=async(e,t,r)=>{let n=(0,s.H9)(a.db,e,t);await (0,s.mZ)(n,{...r,updatedAt:(0,s.O5)()})},c=async(e,t)=>{await (0,s.kd)((0,s.H9)(a.db,e,t))},m=async()=>{let{data:e}=await d("categories","name");return e},u=async e=>{let t=await o("categories",e),r=s.Dc.now();return{id:t,...e,createdAt:r,updatedAt:r}},x=(e,t)=>i("categories",e,t),b=e=>c("categories",e),h=async e=>{let t=e.trim(),r=(0,s.P)((0,s.rJ)(a.db,"categories"),(0,s._M)("name","==",t),(0,s.AB)(1)),n=await (0,s.GG)(r);if(n.empty)return u({name:t});{let e=n.docs[0];return{id:e.id,...e.data()}}},p=async()=>{let{data:e}=await d("products","name");return e},j=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"name",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"asc",a=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0,{data:n,firstDoc:l,lastDoc:o}=await d("products",t,r,e,a,s);return{products:n,firstDoc:l,lastDoc:o}},g=e=>l("products",e),y=e=>o("products",e),f=(e,t)=>i("products",e,t),w=e=>c("products",e),N=async()=>{let{data:e}=await d("customers","name");return e},v=e=>l("customers",e),A=e=>o("customers",e),C=(e,t)=>i("customers",e,t),D=e=>c("customers",e),M=async e=>{let t=(0,s.P)((0,s.rJ)(a.db,"customers"),(0,s._M)("mobileNumber","==",e));return(await (0,s.GG)(t)).docs.map(e=>({id:e.id,...e.data()}))},k=async()=>{let{data:e}=await d("orders","orderDate","desc");return e},I=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"orderDate",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"desc",a=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0,{data:n,firstDoc:l,lastDoc:o}=await d("orders",t,r,e,a,s);return{orders:n,firstDoc:l,lastDoc:o}},S=e=>l("orders",e),J=async(e,t)=>{let r=(0,s.wP)(a.db),d=new Date,l="ORD-".concat((0,n.GP)(d,"yyyyMMdd-HHmmssSSS")),o={...e,orderNumber:l,orderDate:s.Dc.fromDate(d),createdAt:(0,s.O5)(),updatedAt:(0,s.O5)()},i=(0,s.H9)((0,s.rJ)(a.db,"orders"));for(let e of(r.set(i,o),t)){let t=(0,s.H9)(a.db,"products",e.productId),n=await (0,s.x7)(t);if(n.exists()){let a=n.data().quantity||0,d=Math.max(0,a-e.quantity);a<e.quantity&&console.warn("Stock for product ".concat(e.productId," (").concat(n.data().name,") is ").concat(a,", but trying to decrement by ").concat(e.quantity,". Setting to 0.")),r.update(t,{quantity:d,updatedAt:(0,s.O5)()})}else console.warn("Product with ID ".concat(e.productId," not found for stock decrement."))}return await r.commit(),i.id}},86442:(e,t,r)=>{r.d(t,{A:()=>p});var a=r(95155),s=r(54165),n=r(62177),d=r(90221),l=r(55594),o=r(30285),i=r(17759),c=r(62523),m=r(12115),u=r(59434);let x=m.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("textarea",{className:(0,u.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",r),ref:t,...s})});x.displayName="Textarea";let b=l.Ik({name:l.Yj().min(2,"Name must be at least 2 characters."),mobileNumber:l.Yj().min(10,"Mobile number must be at least 10 characters.").regex(/^[+]?[0-9\s-()]{10,}$/,"Invalid mobile number format. Use digits, spaces, hyphens, or parentheses."),email:l.Yj().email("Invalid email address.").optional().or(l.eu("")),address:l.Yj().optional().or(l.eu(""))}),h=e=>{let{customer:t,onSubmit:r,onCancel:s,initialMobileNumber:l}=e,u=(0,n.mN)({resolver:(0,d.u)(b),defaultValues:t?{name:t.name,mobileNumber:t.mobileNumber,email:t.email||"",address:t.address||""}:{name:"",mobileNumber:l||"",email:"",address:""}});return(0,m.useEffect)(()=>{t?u.reset({name:t.name,mobileNumber:t.mobileNumber,email:t.email||"",address:t.address||""}):u.reset({name:"",mobileNumber:l||"",email:"",address:""})},[t,l,u.reset]),(0,a.jsx)(i.lV,{...u,children:(0,a.jsxs)("form",{onSubmit:u.handleSubmit(r),className:"space-y-6",children:[(0,a.jsx)(i.zB,{control:u.control,name:"name",render:e=>{let{field:t}=e;return(0,a.jsxs)(i.eI,{children:[(0,a.jsx)(i.lR,{children:"Full Name"}),(0,a.jsx)(i.MJ,{children:(0,a.jsx)(c.p,{placeholder:"e.g., John Doe",...t})}),(0,a.jsx)(i.C5,{})]})}}),(0,a.jsx)(i.zB,{control:u.control,name:"mobileNumber",render:e=>{let{field:t}=e;return(0,a.jsxs)(i.eI,{children:[(0,a.jsx)(i.lR,{children:"Mobile Number"}),(0,a.jsx)(i.MJ,{children:(0,a.jsx)(c.p,{placeholder:"e.g., 555-123-4567",...t})}),(0,a.jsx)(i.C5,{})]})}}),(0,a.jsx)(i.zB,{control:u.control,name:"email",render:e=>{let{field:t}=e;return(0,a.jsxs)(i.eI,{children:[(0,a.jsx)(i.lR,{children:"Email (Optional)"}),(0,a.jsx)(i.MJ,{children:(0,a.jsx)(c.p,{type:"email",placeholder:"e.g., john.doe@example.com",...t})}),(0,a.jsx)(i.C5,{})]})}}),(0,a.jsx)(i.zB,{control:u.control,name:"address",render:e=>{let{field:t}=e;return(0,a.jsxs)(i.eI,{children:[(0,a.jsx)(i.lR,{children:"Address (Optional)"}),(0,a.jsx)(i.MJ,{children:(0,a.jsx)(x,{placeholder:"e.g., 123 Main St, Anytown, USA",...t,className:"resize-none"})}),(0,a.jsx)(i.C5,{})]})}}),(0,a.jsxs)("div",{className:"flex justify-end space-x-3 pt-4",children:[(0,a.jsx)(o.$,{type:"button",variant:"outline",onClick:s,children:"Cancel"}),(0,a.jsx)(o.$,{type:"submit",className:"bg-primary hover:bg-primary/90",children:t?"Update Customer":"Add Customer"})]})]})})},p=e=>{let{isOpen:t,onOpenChange:r,customer:n,onSubmit:d,initialMobileNumber:l}=e;return(0,a.jsx)(s.lG,{open:t,onOpenChange:r,children:(0,a.jsxs)(s.Cf,{className:"w-full max-w-md sm:max-w-lg md:max-w-[480px]",children:[(0,a.jsxs)(s.c7,{children:[(0,a.jsx)(s.L3,{className:"text-xl sm:text-2xl font-semibold text-primary",children:n?"Edit Customer":"Add New Customer"}),(0,a.jsx)(s.rr,{className:"text-xs sm:text-sm",children:n?"Update the details for this customer.":"Fill in the details to add a new customer."})]}),(0,a.jsx)(h,{customer:n,onSubmit:e=>{d(e)},onCancel:()=>r(!1),initialMobileNumber:l})]})})}}}]);