"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8970],{30285:(e,t,o)=>{o.d(t,{$:()=>d,r:()=>s});var r=o(95155),n=o(12115),a=o(99708),i=o(74466),l=o(59434);let s=(0,i.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),d=n.forwardRef((e,t)=>{let{className:o,variant:n,size:i,asChild:d=!1,...u}=e,c=d?a.DX:"button";return(0,r.jsx)(c,{className:(0,l.cn)(s({variant:n,size:i,className:o})),ref:t,...u})});d.displayName="Button"},40283:(e,t,o)=>{o.d(t,{AuthProvider:()=>f,Z:()=>g});var r=o(95155),n=o(93004),a=o(12115),i=o(56104),l=o(84744),s=o(35695),d=o(87481),u=o(35317);let c=(0,a.createContext)(void 0),f=e=>{let{children:t}=e,[o,f]=(0,a.useState)(null),[g,p]=(0,a.useState)(null),[m,h]=(0,a.useState)(!0),b=(0,s.useRouter)(),{toast:A}=(0,d.dj)();(0,a.useEffect)(()=>{console.log("AuthContext: Subscribing to onAuthStateChanged.");let e=(0,n.hg)(i.j2,async e=>{console.log("AuthContext: onAuthStateChanged triggered. User:",e?e.uid:null),h(!0);try{if(e){f(e),console.log("AuthContext: User is authenticated. Fetching profile for UID:",e.uid);let t=await (0,l.VM)(e.uid);if(console.log("AuthContext: Initial getUserProfile returned:",JSON.stringify(t)),t)console.log("AuthContext: Profile found for ".concat(e.uid,":"),JSON.stringify(t));else{console.log("AuthContext: No profile for ".concat(e.uid,", attempting to create one."));let o=(0,u.rJ)(i.db,"users"),r=(0,u.P)(o,(0,u._M)("role","==","owner"),(0,u.AB)(1));console.log("AuthContext: Querying for existing owner...");let n=await (0,u.GG)(r);console.log("AuthContext: Owner query snapshot empty:",n.empty);let a="employee";n.empty?(a="owner",A({title:"Welcome, Owner!",description:"You are the first user and have been assigned the Owner role.",duration:7e3}),console.log("AuthContext: Assigning role 'owner' to ".concat(e.uid,"."))):(a="employee",A({title:"Account Initialized",description:"Your user profile has been created with the Employee role.",duration:5e3}),console.log("AuthContext: Assigning role 'employee' to ".concat(e.uid,"."))),await (0,l.en)(e.uid,e.email,e.displayName,a,e.phoneNumber),console.log("AuthContext: Profile creation attempt for ".concat(e.uid," with role ").concat(a," finished. Refetching profile...")),(t=await (0,l.VM)(e.uid))?console.log("AuthContext: Profile created and refetched for ".concat(e.uid,":"),JSON.stringify(t)):console.error("AuthContext: CRITICAL - Profile still null after creation for ".concat(e.uid))}p(t),console.log("AuthContext: setUserProfile called with (after fetch/create):",JSON.stringify(t))}else console.log("AuthContext: No user authenticated. Clearing currentUser and userProfile."),f(null),p(null)}catch(e){console.error("AuthContext: Error during onAuthStateChanged logic:",e),f(null),p(null)}finally{console.log("AuthContext: Setting isLoading to false."),h(!1)}});return()=>{console.log("AuthContext: Unsubscribing from onAuthStateChanged."),e()}},[A]);let v=async()=>{h(!0);try{await (0,n.CI)(i.j2),b.push("/login"),A({title:"Logged Out",description:"You have been successfully logged out."})}catch(e){console.error("AuthProvider: Error signing out:",e),A({title:"Logout Failed",description:"Could not sign out. Please try again.",variant:"destructive"})}finally{}};return(0,r.jsx)(c.Provider,{value:{currentUser:o,userProfile:g,isLoading:m,logout:v},children:t})},g=()=>{let e=(0,a.useContext)(c);if(void 0===e)throw Error("useAuthContext must be used within an AuthProvider");return e}},56104:(e,t,o)=>{o.d(t,{db:()=>u,j2:()=>d});var r=o(23915),n=o(93004),a=o(35317),i=o(90858);let l={apiKey:"AIzaSyDg6GxXw9p6HLbxDIuVVgbLdjGNDvCrEOI",authDomain:"stockpilot-sz1ou.firebaseapp.com",projectId:"stockpilot-sz1ou",storageBucket:"stockpilot-sz1ou.appspot.com",messagingSenderId:"887969524276",appId:"1:887969524276:web:88b5cdad25b9cff1463861",measurementId:o(49509).env.NEXT_PUBLIC_FIREBASE_MEASUREMENT_ID},s=(0,r.Dk)().length?(0,r.Sx)():(0,r.Wp)(l),d=(0,n.xI)(s),u=(0,a.aU)(s);(0,i.c7)(s)},59434:(e,t,o)=>{o.d(t,{cn:()=>a});var r=o(52596),n=o(39688);function a(){for(var e=arguments.length,t=Array(e),o=0;o<e;o++)t[o]=arguments[o];return(0,n.QP)((0,r.$)(t))}},66681:(e,t,o)=>{o.d(t,{A:()=>r.Z});var r=o(40283)},66695:(e,t,o)=>{o.d(t,{BT:()=>d,Wu:()=>u,ZB:()=>s,Zp:()=>i,aR:()=>l,wL:()=>c});var r=o(95155),n=o(12115),a=o(59434);let i=n.forwardRef((e,t)=>{let{className:o,...n}=e;return(0,r.jsx)("div",{ref:t,className:(0,a.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",o),...n})});i.displayName="Card";let l=n.forwardRef((e,t)=>{let{className:o,...n}=e;return(0,r.jsx)("div",{ref:t,className:(0,a.cn)("flex flex-col space-y-1.5 p-4 sm:p-6",o),...n})});l.displayName="CardHeader";let s=n.forwardRef((e,t)=>{let{className:o,...n}=e;return(0,r.jsx)("h2",{ref:t,className:(0,a.cn)("text-xl font-semibold leading-none tracking-tight",o),...n})});s.displayName="CardTitle";let d=n.forwardRef((e,t)=>{let{className:o,...n}=e;return(0,r.jsx)("p",{ref:t,className:(0,a.cn)("text-sm text-muted-foreground",o),...n})});d.displayName="CardDescription";let u=n.forwardRef((e,t)=>{let{className:o,...n}=e;return(0,r.jsx)("div",{ref:t,className:(0,a.cn)("p-4 sm:p-6",o),...n})});u.displayName="CardContent";let c=n.forwardRef((e,t)=>{let{className:o,...n}=e;return(0,r.jsx)("div",{ref:t,className:(0,a.cn)("flex items-center p-4 sm:p-6 pt-0",o),...n})});c.displayName="CardFooter"},68856:(e,t,o)=>{o.d(t,{E:()=>a});var r=o(95155),n=o(59434);function a(e){let{className:t,...o}=e;return(0,r.jsx)("div",{className:(0,n.cn)("animate-pulse rounded-md bg-muted",t),...o})}},84744:(e,t,o)=>{o.d(t,{VM:()=>a,eg:()=>s,en:()=>i,jQ:()=>l,s0:()=>d});var r=o(56104),n=o(35317);let a=async e=>{if(!e)return null;let t=(0,n.H9)(r.db,"users",e),o=await (0,n.x7)(t);if(o.exists()){var a,i;let e=o.data();return{id:o.id,email:e.email||null,displayName:e.displayName||null,mobileNumber:e.mobileNumber||null,role:e.role,createdAt:(null==(a=e.createdAt)?void 0:a.toDate)?e.createdAt.toDate().toISOString():void 0,updatedAt:(null==(i=e.updatedAt)?void 0:i.toDate)?e.updatedAt.toDate().toISOString():void 0}}return null},i=async(e,t,o,a,i)=>{let l=(0,n.H9)(r.db,"users",e),s={email:t,displayName:o,role:a,mobileNumber:i||null,createdAt:(0,n.O5)(),updatedAt:(0,n.O5)()};return await (0,n.BN)(l,s),{id:e,email:t,displayName:o,mobileNumber:i||null,role:a}},l=async()=>{let e=(0,n.rJ)(r.db,"users"),t=(0,n.P)(e,(0,n.My)("displayName","asc"));return(await (0,n.GG)(t)).docs.map(e=>{var t,o;let r=e.data();return{id:e.id,email:r.email||null,displayName:r.displayName||null,mobileNumber:r.mobileNumber||null,role:r.role,createdAt:(null==(t=r.createdAt)?void 0:t.toDate)?r.createdAt.toDate().toISOString():void 0,updatedAt:(null==(o=r.updatedAt)?void 0:o.toDate)?r.updatedAt.toDate().toISOString():void 0}})},s=async(e,t)=>{let o=(0,n.H9)(r.db,"users",e),a={...t,updatedAt:(0,n.O5)()};(void 0!==t.mobileNumber||"mobileNumber"in t)&&(null===t.mobileNumber||""===t.mobileNumber)&&(a.mobileNumber=null),await (0,n.mZ)(o,a)},d=async e=>{let t=(0,n.wP)(r.db),o=(0,n.H9)(r.db,"users",e);t.delete(o),await t.commit(),console.warn("Firestore profile for UID ".concat(e," deleted. Firebase Auth user account may still exist."))}},87481:(e,t,o)=>{o.d(t,{dj:()=>f});var r=o(12115);let n=0,a=new Map,i=e=>{if(a.has(e))return;let t=setTimeout(()=>{a.delete(e),u({type:"REMOVE_TOAST",toastId:e})},1e6);a.set(e,t)},l=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:o}=t;return o?i(o):e.toasts.forEach(e=>{i(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===o||void 0===o?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},s=[],d={toasts:[]};function u(e){d=l(d,e),s.forEach(e=>{e(d)})}function c(e){let{...t}=e,o=(n=(n+1)%Number.MAX_SAFE_INTEGER).toString(),r=()=>u({type:"DISMISS_TOAST",toastId:o});return u({type:"ADD_TOAST",toast:{...t,id:o,open:!0,onOpenChange:e=>{e||r()}}}),{id:o,dismiss:r,update:e=>u({type:"UPDATE_TOAST",toast:{...e,id:o}})}}function f(){let[e,t]=r.useState(d);return r.useEffect(()=>(s.push(t),()=>{let e=s.indexOf(t);e>-1&&s.splice(e,1)}),[e]),{...e,toast:c,dismiss:e=>u({type:"DISMISS_TOAST",toastId:e})}}}}]);